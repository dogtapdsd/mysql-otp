<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>cover/mysql.COVER.html</title>
<style>body {
  font: 14px/1.6 "Helvetica Neue", Helvetica, Arial, sans-serif;
  margin: 0;
  padding: 0;
  color: #000;
  border-top: 2px solid #ddd;
  background-color: #fff;

  min-height: 100%;
  display: flex;
  flex-direction: column;
}

h1 {
  width: 100%;
  border-bottom: 1px solid #eee;
  margin-bottom: 0;
  font-weight: 100;
  font-size: 1.1em;
  letter-spacing: 1px;
}

h1 code {
  font-size: 0.96em;
}

code {
  font: 12px monospace;
}

footer {
  background: #eee;
  width: 100%;
  padding: 10px 0;
  text-align: right;
  border-top: 1px solid #ddd;
  display: flex;
  flex: 1;
  order: 2;
  justify-content: center;
}

table {
  width: 100%;
  margin-top: 10px;
  border-collapse: collapse;
  border: 1px solid #cbcbcb;
  color: #000;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
}
table thead {
  display: none;
}
table td.line,
table td.hits {
  width: 20px;
  background: #eaeaea;
  text-align: center;
  font-size: 11px;
  padding: 0 10px;
  color: #949494;
}
table td.hits {
  width: 10px;
  padding: 2px 5px;
  color: rgba(0, 0, 0, 0.6);
  background-color: #f0f0f0;
}
tr.miss td.line,
tr.miss td.hits {
  background-color: #ffdce0;
  border-color: #fdaeb7;
}
tr.miss td {
  background-color: #ffeef0;
}
tr.hit td.line,
tr.hit td.hits {
  background-color: #cdffd8;
  border-color: #bef5cb;
}
tr.hit td {
  background-color: #e6ffed;
}
td.source {
  padding-left: 15px;
  line-height: 15px;
  white-space: pre;
  font: 12px monospace;
}
</style>
</head>
<body>
<h1><code>cover/mysql.COVER.html</code></h1>
<footer><p>File generated from <code>/home/viktor/repos/mysql-otp/ebin/../src/mysql.erl</code> by <a href="http://erlang.org/doc/man/cover.html">cover</a> at 2019-10-16 at 01:20:11</p></footer>
<table>
<tbody>
<tr>
<td class="line" id="L1">1</td>
<td class="hits"></td>
<td class="source"><code>%% MySQL/OTP – MySQL client library for Erlang/OTP</code></td>
</tr>
<tr>
<td class="line" id="L2">2</td>
<td class="hits"></td>
<td class="source"><code>%% Copyright (C) 2014-2015, 2018 Viktor Söderqvist,</code></td>
</tr>
<tr>
<td class="line" id="L3">3</td>
<td class="hits"></td>
<td class="source"><code>%%               2016 Johan Lövdahl</code></td>
</tr>
<tr>
<td class="line" id="L4">4</td>
<td class="hits"></td>
<td class="source"><code>%%               2017 Piotr Nosek, Michal Slaski</code></td>
</tr>
<tr>
<td class="line" id="L5">5</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L6">6</td>
<td class="hits"></td>
<td class="source"><code>%% This file is part of MySQL/OTP.</code></td>
</tr>
<tr>
<td class="line" id="L7">7</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L8">8</td>
<td class="hits"></td>
<td class="source"><code>%% MySQL/OTP is free software: you can redistribute it and/or modify it under</code></td>
</tr>
<tr>
<td class="line" id="L9">9</td>
<td class="hits"></td>
<td class="source"><code>%% the terms of the GNU Lesser General Public License as published by the Free</code></td>
</tr>
<tr>
<td class="line" id="L10">10</td>
<td class="hits"></td>
<td class="source"><code>%% Software Foundation, either version 3 of the License, or (at your option)</code></td>
</tr>
<tr>
<td class="line" id="L11">11</td>
<td class="hits"></td>
<td class="source"><code>%% any later version.</code></td>
</tr>
<tr>
<td class="line" id="L12">12</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L13">13</td>
<td class="hits"></td>
<td class="source"><code>%% This program is distributed in the hope that it will be useful, but WITHOUT</code></td>
</tr>
<tr>
<td class="line" id="L14">14</td>
<td class="hits"></td>
<td class="source"><code>%% ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</code></td>
</tr>
<tr>
<td class="line" id="L15">15</td>
<td class="hits"></td>
<td class="source"><code>%% FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for</code></td>
</tr>
<tr>
<td class="line" id="L16">16</td>
<td class="hits"></td>
<td class="source"><code>%% more details.</code></td>
</tr>
<tr>
<td class="line" id="L17">17</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L18">18</td>
<td class="hits"></td>
<td class="source"><code>%% You should have received a copy of the GNU Lesser General Public License</code></td>
</tr>
<tr>
<td class="line" id="L19">19</td>
<td class="hits"></td>
<td class="source"><code>%% along with this program. If not, see &lt;https://www.gnu.org/licenses/&gt;.</code></td>
</tr>
<tr>
<td class="line" id="L20">20</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L21">21</td>
<td class="hits"></td>
<td class="source"><code>%% @doc MySQL client.</code></td>
</tr>
<tr>
<td class="line" id="L22">22</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L23">23</td>
<td class="hits"></td>
<td class="source"><code>%% The `connection()' type is a gen_server reference as described in the</code></td>
</tr>
<tr>
<td class="line" id="L24">24</td>
<td class="hits"></td>
<td class="source"><code>%% documentation for `gen_server:call/2,3', e.g. the pid or the name if the</code></td>
</tr>
<tr>
<td class="line" id="L25">25</td>
<td class="hits"></td>
<td class="source"><code>%% gen_server is locally registered.</code></td>
</tr>
<tr>
<td class="line" id="L26">26</td>
<td class="hits"></td>
<td class="source"><code>-module(mysql).</code></td>
</tr>
<tr>
<td class="line" id="L27">27</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L28">28</td>
<td class="hits"></td>
<td class="source"><code>-export([start_link/1, stop/1, stop/2,</code></td>
</tr>
<tr>
<td class="line" id="L29">29</td>
<td class="hits"></td>
<td class="source"><code>         query/2, query/3, query/4, query/5,</code></td>
</tr>
<tr>
<td class="line" id="L30">30</td>
<td class="hits"></td>
<td class="source"><code>         execute/3, execute/4, execute/5,</code></td>
</tr>
<tr>
<td class="line" id="L31">31</td>
<td class="hits"></td>
<td class="source"><code>         prepare/2, prepare/3, unprepare/2,</code></td>
</tr>
<tr>
<td class="line" id="L32">32</td>
<td class="hits"></td>
<td class="source"><code>         warning_count/1, affected_rows/1, autocommit/1, insert_id/1,</code></td>
</tr>
<tr>
<td class="line" id="L33">33</td>
<td class="hits"></td>
<td class="source"><code>         encode/2, in_transaction/1,</code></td>
</tr>
<tr>
<td class="line" id="L34">34</td>
<td class="hits"></td>
<td class="source"><code>         transaction/2, transaction/3, transaction/4,</code></td>
</tr>
<tr>
<td class="line" id="L35">35</td>
<td class="hits"></td>
<td class="source"><code>         change_user/3, change_user/4, reset_connection/1]).</code></td>
</tr>
<tr>
<td class="line" id="L36">36</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L37">37</td>
<td class="hits"></td>
<td class="source"><code>-export_type([connection/0, server_reason/0, query_result/0]).</code></td>
</tr>
<tr>
<td class="line" id="L38">38</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L39">39</td>
<td class="hits"></td>
<td class="source"><code>%% A connection is a ServerRef as in gen_server:call/2,3.</code></td>
</tr>
<tr>
<td class="line" id="L40">40</td>
<td class="hits"></td>
<td class="source"><code>-type connection() :: Name :: atom() |</code></td>
</tr>
<tr>
<td class="line" id="L41">41</td>
<td class="hits"></td>
<td class="source"><code>                      {Name :: atom(), Node :: atom()} |</code></td>
</tr>
<tr>
<td class="line" id="L42">42</td>
<td class="hits"></td>
<td class="source"><code>                      {global, GlobalName :: term()} |</code></td>
</tr>
<tr>
<td class="line" id="L43">43</td>
<td class="hits"></td>
<td class="source"><code>                      {via, Module :: atom(), ViaName :: term()} |</code></td>
</tr>
<tr>
<td class="line" id="L44">44</td>
<td class="hits"></td>
<td class="source"><code>                      pid().</code></td>
</tr>
<tr>
<td class="line" id="L45">45</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L46">46</td>
<td class="hits"></td>
<td class="source"><code>%% MySQL error with the codes and message returned from the server.</code></td>
</tr>
<tr>
<td class="line" id="L47">47</td>
<td class="hits"></td>
<td class="source"><code>-type server_reason() :: {Code :: integer(), SQLState :: binary() | undefined,</code></td>
</tr>
<tr>
<td class="line" id="L48">48</td>
<td class="hits"></td>
<td class="source"><code>                          Message :: binary()}.</code></td>
</tr>
<tr>
<td class="line" id="L49">49</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L50">50</td>
<td class="hits"></td>
<td class="source"><code>-type column_names() :: [binary()].</code></td>
</tr>
<tr>
<td class="line" id="L51">51</td>
<td class="hits"></td>
<td class="source"><code>-type row() :: [term()].</code></td>
</tr>
<tr>
<td class="line" id="L52">52</td>
<td class="hits"></td>
<td class="source"><code>-type rows() :: [row()].</code></td>
</tr>
<tr>
<td class="line" id="L53">53</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L54">54</td>
<td class="hits"></td>
<td class="source"><code>-type query_filtermap_fun() :: fun((row()) -&gt; query_filtermap_res())</code></td>
</tr>
<tr>
<td class="line" id="L55">55</td>
<td class="hits"></td>
<td class="source"><code>                             | fun((column_names(), row()) -&gt; query_filtermap_res()).</code></td>
</tr>
<tr>
<td class="line" id="L56">56</td>
<td class="hits"></td>
<td class="source"><code>-type query_filtermap_res() :: boolean()</code></td>
</tr>
<tr>
<td class="line" id="L57">57</td>
<td class="hits"></td>
<td class="source"><code>                             | {true, term()}.</code></td>
</tr>
<tr>
<td class="line" id="L58">58</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L59">59</td>
<td class="hits"></td>
<td class="source"><code>-type query_result() :: ok</code></td>
</tr>
<tr>
<td class="line" id="L60">60</td>
<td class="hits"></td>
<td class="source"><code>                      | {ok, column_names(), rows()}</code></td>
</tr>
<tr>
<td class="line" id="L61">61</td>
<td class="hits"></td>
<td class="source"><code>                      | {ok, [{column_names(), rows()}, ...]}</code></td>
</tr>
<tr>
<td class="line" id="L62">62</td>
<td class="hits"></td>
<td class="source"><code>                      | {error, server_reason()}.</code></td>
</tr>
<tr>
<td class="line" id="L63">63</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L64">64</td>
<td class="hits"></td>
<td class="source"><code>-define(default_connect_timeout, 5000).</code></td>
</tr>
<tr>
<td class="line" id="L65">65</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L66">66</td>
<td class="hits"></td>
<td class="source"><code>-include("exception.hrl").</code></td>
</tr>
<tr>
<td class="line" id="L67">67</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L68">68</td>
<td class="hits"></td>
<td class="source"><code>%% @doc Starts a connection gen_server process and connects to a database. To</code></td>
</tr>
<tr>
<td class="line" id="L69">69</td>
<td class="hits"></td>
<td class="source"><code>%% disconnect use `mysql:stop/1,2'.</code></td>
</tr>
<tr>
<td class="line" id="L70">70</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L71">71</td>
<td class="hits"></td>
<td class="source"><code>%% Options:</code></td>
</tr>
<tr>
<td class="line" id="L72">72</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L73">73</td>
<td class="hits"></td>
<td class="source"><code>%% &lt;dl&gt;</code></td>
</tr>
<tr>
<td class="line" id="L74">74</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dt&gt;`{name, ServerName}'&lt;/dt&gt;</code></td>
</tr>
<tr>
<td class="line" id="L75">75</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dd&gt;If a name is provided, the gen_server will be registered with this</code></td>
</tr>
<tr>
<td class="line" id="L76">76</td>
<td class="hits"></td>
<td class="source"><code>%%       name. For details see the documentation for the first argument of</code></td>
</tr>
<tr>
<td class="line" id="L77">77</td>
<td class="hits"></td>
<td class="source"><code>%%       gen_server:start_link/4.&lt;/dd&gt;</code></td>
</tr>
<tr>
<td class="line" id="L78">78</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dt&gt;`{host, Host}'&lt;/dt&gt;</code></td>
</tr>
<tr>
<td class="line" id="L79">79</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dd&gt;Hostname of the MySQL database. Since OTP version 19, it is also</code></td>
</tr>
<tr>
<td class="line" id="L80">80</td>
<td class="hits"></td>
<td class="source"><code>%%       possible to specify a local (Unix) Socket by specifying</code></td>
</tr>
<tr>
<td class="line" id="L81">81</td>
<td class="hits"></td>
<td class="source"><code>%%       `{local, SocketFile}'. Default `"localhost"'.&lt;/dd&gt;</code></td>
</tr>
<tr>
<td class="line" id="L82">82</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dt&gt;`{port, Port}'&lt;/dt&gt;</code></td>
</tr>
<tr>
<td class="line" id="L83">83</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dd&gt;Port; default 3306 for non-local or 0 for local (Unix) sockets.&lt;/dd&gt;</code></td>
</tr>
<tr>
<td class="line" id="L84">84</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dt&gt;`{user, User}'&lt;/dt&gt;</code></td>
</tr>
<tr>
<td class="line" id="L85">85</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dd&gt;Username.&lt;/dd&gt;</code></td>
</tr>
<tr>
<td class="line" id="L86">86</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dt&gt;`{password, Password}'&lt;/dt&gt;</code></td>
</tr>
<tr>
<td class="line" id="L87">87</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dd&gt;Password.&lt;/dd&gt;</code></td>
</tr>
<tr>
<td class="line" id="L88">88</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dt&gt;`{database, Database}'&lt;/dt&gt;</code></td>
</tr>
<tr>
<td class="line" id="L89">89</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dd&gt;The name of the database AKA schema to use. This can be changed later</code></td>
</tr>
<tr>
<td class="line" id="L90">90</td>
<td class="hits"></td>
<td class="source"><code>%%       using the query `USE &lt;database&gt;'.&lt;/dd&gt;</code></td>
</tr>
<tr>
<td class="line" id="L91">91</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dt&gt;`{connect_timeout, Timeout}'&lt;/dt&gt;</code></td>
</tr>
<tr>
<td class="line" id="L92">92</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dd&gt;The maximum time to spend for start_link/1.&lt;/dd&gt;</code></td>
</tr>
<tr>
<td class="line" id="L93">93</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dt&gt;`{log_warnings, boolean()}'&lt;/dt&gt;</code></td>
</tr>
<tr>
<td class="line" id="L94">94</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dd&gt;Whether to fetch warnings and log them using error_logger; default</code></td>
</tr>
<tr>
<td class="line" id="L95">95</td>
<td class="hits"></td>
<td class="source"><code>%%       true.&lt;/dd&gt;</code></td>
</tr>
<tr>
<td class="line" id="L96">96</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dt&gt;`{keep_alive, boolean() | timeout()}'&lt;/dt&gt;</code></td>
</tr>
<tr>
<td class="line" id="L97">97</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dd&gt;Send ping when unused for a certain time. Possible values are `true',</code></td>
</tr>
<tr>
<td class="line" id="L98">98</td>
<td class="hits"></td>
<td class="source"><code>%%       `false' and `integer() &gt; 0' for an explicit interval in milliseconds.</code></td>
</tr>
<tr>
<td class="line" id="L99">99</td>
<td class="hits"></td>
<td class="source"><code>%%       The default is `false'. For `true' a default ping timeout is used.</code></td>
</tr>
<tr>
<td class="line" id="L100">100</td>
<td class="hits"></td>
<td class="source"><code>%%       &lt;/dd&gt;</code></td>
</tr>
<tr>
<td class="line" id="L101">101</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dt&gt;`{prepare, NamedStatements}'&lt;/dt&gt;</code></td>
</tr>
<tr>
<td class="line" id="L102">102</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dd&gt;Named prepared statements to be created as soon as the connection is</code></td>
</tr>
<tr>
<td class="line" id="L103">103</td>
<td class="hits"></td>
<td class="source"><code>%%       ready.&lt;/dd&gt;</code></td>
</tr>
<tr>
<td class="line" id="L104">104</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dt&gt;`{queries, Queries}'&lt;/dt&gt;</code></td>
</tr>
<tr>
<td class="line" id="L105">105</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dd&gt;Queries to be executed as soon as the connection is ready. Any results</code></td>
</tr>
<tr>
<td class="line" id="L106">106</td>
<td class="hits"></td>
<td class="source"><code>%%       are discarded. Typically, this is used for setting time zone and other</code></td>
</tr>
<tr>
<td class="line" id="L107">107</td>
<td class="hits"></td>
<td class="source"><code>%%       session variables.&lt;/dd&gt;</code></td>
</tr>
<tr>
<td class="line" id="L108">108</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dt&gt;`{query_timeout, Timeout}'&lt;/dt&gt;</code></td>
</tr>
<tr>
<td class="line" id="L109">109</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dd&gt;The default time to wait for a response when executing a query or a</code></td>
</tr>
<tr>
<td class="line" id="L110">110</td>
<td class="hits"></td>
<td class="source"><code>%%       prepared statement. This can be given per query using `query/3,4' and</code></td>
</tr>
<tr>
<td class="line" id="L111">111</td>
<td class="hits"></td>
<td class="source"><code>%%       `execute/4'. The default is `infinity'.&lt;/dd&gt;</code></td>
</tr>
<tr>
<td class="line" id="L112">112</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dt&gt;`{found_rows, boolean()}'&lt;/dt&gt;</code></td>
</tr>
<tr>
<td class="line" id="L113">113</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dd&gt;If set to true, the connection will be established with</code></td>
</tr>
<tr>
<td class="line" id="L114">114</td>
<td class="hits"></td>
<td class="source"><code>%%       CLIENT_FOUND_ROWS capability. affected_rows/1 will now return the</code></td>
</tr>
<tr>
<td class="line" id="L115">115</td>
<td class="hits"></td>
<td class="source"><code>%%       number of found rows, not the number of rows changed by the</code></td>
</tr>
<tr>
<td class="line" id="L116">116</td>
<td class="hits"></td>
<td class="source"><code>%%       query.&lt;/dd&gt;</code></td>
</tr>
<tr>
<td class="line" id="L117">117</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dt&gt;`{query_cache_time, Timeout}'&lt;/dt&gt;</code></td>
</tr>
<tr>
<td class="line" id="L118">118</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dd&gt;The minimum number of milliseconds to cache prepared statements used</code></td>
</tr>
<tr>
<td class="line" id="L119">119</td>
<td class="hits"></td>
<td class="source"><code>%%       for parametrized queries with query/3.&lt;/dd&gt;</code></td>
</tr>
<tr>
<td class="line" id="L120">120</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dt&gt;`{tcp_options, Options}'&lt;/dt&gt;</code></td>
</tr>
<tr>
<td class="line" id="L121">121</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dd&gt;Additional options for `gen_tcp:connect/3'. You may want to set</code></td>
</tr>
<tr>
<td class="line" id="L122">122</td>
<td class="hits"></td>
<td class="source"><code>%%       `{recbuf, Size}' and `{sndbuf, Size}' if you send or receive more than</code></td>
</tr>
<tr>
<td class="line" id="L123">123</td>
<td class="hits"></td>
<td class="source"><code>%%       the default (typically 8K) per query.&lt;/dd&gt;</code></td>
</tr>
<tr>
<td class="line" id="L124">124</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dt&gt;`{ssl, Options}'&lt;/dt&gt;</code></td>
</tr>
<tr>
<td class="line" id="L125">125</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;dd&gt;Additional options for `ssl:connect/3'.&lt;/dd&gt;</code></td>
</tr>
<tr>
<td class="line" id="L126">126</td>
<td class="hits"></td>
<td class="source"><code>%% &lt;/dl&gt;</code></td>
</tr>
<tr>
<td class="line" id="L127">127</td>
<td class="hits"></td>
<td class="source"><code>-spec start_link(Options) -&gt; {ok, pid()} | ignore | {error, term()}</code></td>
</tr>
<tr>
<td class="line" id="L128">128</td>
<td class="hits"></td>
<td class="source"><code>    when Options :: [Option],</code></td>
</tr>
<tr>
<td class="line" id="L129">129</td>
<td class="hits"></td>
<td class="source"><code>         Option :: {name, ServerName} |</code></td>
</tr>
<tr>
<td class="line" id="L130">130</td>
<td class="hits"></td>
<td class="source"><code>                   {host, inet:socket_address() | inet:hostname()} | {port, integer()} |</code></td>
</tr>
<tr>
<td class="line" id="L131">131</td>
<td class="hits"></td>
<td class="source"><code>                   {user, iodata()} | {password, iodata()} |</code></td>
</tr>
<tr>
<td class="line" id="L132">132</td>
<td class="hits"></td>
<td class="source"><code>                   {database, iodata()} |</code></td>
</tr>
<tr>
<td class="line" id="L133">133</td>
<td class="hits"></td>
<td class="source"><code>                   {connect_timeout, timeout()} |</code></td>
</tr>
<tr>
<td class="line" id="L134">134</td>
<td class="hits"></td>
<td class="source"><code>                   {log_warnings, boolean()} |</code></td>
</tr>
<tr>
<td class="line" id="L135">135</td>
<td class="hits"></td>
<td class="source"><code>                   {keep_alive, boolean() | timeout()} |</code></td>
</tr>
<tr>
<td class="line" id="L136">136</td>
<td class="hits"></td>
<td class="source"><code>                   {prepare, NamedStatements} |</code></td>
</tr>
<tr>
<td class="line" id="L137">137</td>
<td class="hits"></td>
<td class="source"><code>                   {queries, [iodata()]} |</code></td>
</tr>
<tr>
<td class="line" id="L138">138</td>
<td class="hits"></td>
<td class="source"><code>                   {query_timeout, timeout()} |</code></td>
</tr>
<tr>
<td class="line" id="L139">139</td>
<td class="hits"></td>
<td class="source"><code>                   {found_rows, boolean()} |</code></td>
</tr>
<tr>
<td class="line" id="L140">140</td>
<td class="hits"></td>
<td class="source"><code>                   {query_cache_time, non_neg_integer()} |</code></td>
</tr>
<tr>
<td class="line" id="L141">141</td>
<td class="hits"></td>
<td class="source"><code>                   {tcp_options, [gen_tcp:connect_option()]} |</code></td>
</tr>
<tr>
<td class="line" id="L142">142</td>
<td class="hits"></td>
<td class="source"><code>                   {ssl, term()},</code></td>
</tr>
<tr>
<td class="line" id="L143">143</td>
<td class="hits"></td>
<td class="source"><code>         ServerName :: {local, Name :: atom()} |</code></td>
</tr>
<tr>
<td class="line" id="L144">144</td>
<td class="hits"></td>
<td class="source"><code>                       {global, GlobalName :: term()} |</code></td>
</tr>
<tr>
<td class="line" id="L145">145</td>
<td class="hits"></td>
<td class="source"><code>                       {via, Module :: atom(), ViaName :: term()},</code></td>
</tr>
<tr>
<td class="line" id="L146">146</td>
<td class="hits"></td>
<td class="source"><code>         NamedStatements :: [{StatementName :: atom(), Statement :: iodata()}].</code></td>
</tr>
<tr>
<td class="line" id="L147">147</td>
<td class="hits"></td>
<td class="source"><code>start_link(Options) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L148">148</td>
<td class="hits">34</td>
<td class="source"><code>    GenSrvOpts = [{timeout, proplists:get_value(connect_timeout, Options,</code></td>
</tr>
<tr>
<td class="line" id="L149">149</td>
<td class="hits"></td>
<td class="source"><code>                                                ?default_connect_timeout)}],</code></td>
</tr>
<tr class="hit">
<td class="line" id="L150">150</td>
<td class="hits">34</td>
<td class="source"><code>    case proplists:get_value(name, Options) of</code></td>
</tr>
<tr>
<td class="line" id="L151">151</td>
<td class="hits"></td>
<td class="source"><code>        undefined -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L152">152</td>
<td class="hits">32</td>
<td class="source"><code>            gen_server:start_link(mysql_conn, Options, GenSrvOpts);</code></td>
</tr>
<tr>
<td class="line" id="L153">153</td>
<td class="hits"></td>
<td class="source"><code>        ServerName -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L154">154</td>
<td class="hits">2</td>
<td class="source"><code>            gen_server:start_link(ServerName, mysql_conn, Options, GenSrvOpts)</code></td>
</tr>
<tr>
<td class="line" id="L155">155</td>
<td class="hits"></td>
<td class="source"><code>    end.</code></td>
</tr>
<tr>
<td class="line" id="L156">156</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L157">157</td>
<td class="hits"></td>
<td class="source"><code>%% @see stop/2.</code></td>
</tr>
<tr>
<td class="line" id="L158">158</td>
<td class="hits"></td>
<td class="source"><code>-spec stop(Conn) -&gt; ok</code></td>
</tr>
<tr>
<td class="line" id="L159">159</td>
<td class="hits"></td>
<td class="source"><code>    when Conn :: connection().</code></td>
</tr>
<tr>
<td class="line" id="L160">160</td>
<td class="hits"></td>
<td class="source"><code>stop(Conn) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L161">161</td>
<td class="hits">24</td>
<td class="source"><code>    stop(Conn, infinity).</code></td>
</tr>
<tr>
<td class="line" id="L162">162</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L163">163</td>
<td class="hits"></td>
<td class="source"><code>%% @doc Stops a connection process and closes the connection. The</code></td>
</tr>
<tr>
<td class="line" id="L164">164</td>
<td class="hits"></td>
<td class="source"><code>%% process calling `stop' will be blocked until the connection</code></td>
</tr>
<tr>
<td class="line" id="L165">165</td>
<td class="hits"></td>
<td class="source"><code>%% process stops or the given timeout expires.</code></td>
</tr>
<tr>
<td class="line" id="L166">166</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L167">167</td>
<td class="hits"></td>
<td class="source"><code>%% If the connection is not stopped within the given timeout,</code></td>
</tr>
<tr>
<td class="line" id="L168">168</td>
<td class="hits"></td>
<td class="source"><code>%% an exit exception is raised with reason `timeout'.</code></td>
</tr>
<tr>
<td class="line" id="L169">169</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L170">170</td>
<td class="hits"></td>
<td class="source"><code>%% If the connection process exits with any other reason than `normal',</code></td>
</tr>
<tr>
<td class="line" id="L171">171</td>
<td class="hits"></td>
<td class="source"><code>%% an exit exception is raised with that reason.</code></td>
</tr>
<tr>
<td class="line" id="L172">172</td>
<td class="hits"></td>
<td class="source"><code>-spec stop(Conn, Timeout) -&gt; ok</code></td>
</tr>
<tr>
<td class="line" id="L173">173</td>
<td class="hits"></td>
<td class="source"><code>    when Conn :: connection(),</code></td>
</tr>
<tr>
<td class="line" id="L174">174</td>
<td class="hits"></td>
<td class="source"><code>         Timeout :: timeout().</code></td>
</tr>
<tr>
<td class="line" id="L175">175</td>
<td class="hits"></td>
<td class="source"><code>stop(Conn, Timeout) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L176">176</td>
<td class="hits">25</td>
<td class="source"><code>    case erlang:function_exported(gen_server, stop, 3) of</code></td>
</tr>
<tr class="hit">
<td class="line" id="L177">177</td>
<td class="hits">25</td>
<td class="source"><code>        true -&gt; gen_server:stop(Conn, normal, Timeout);            %% OTP &gt;= 18</code></td>
</tr>
<tr class="miss">
<td class="line" id="L178">178</td>
<td class="hits">0</td>
<td class="source"><code>        false -&gt; backported_gen_server_stop(Conn, normal, Timeout) %% OTP &lt; 18</code></td>
</tr>
<tr>
<td class="line" id="L179">179</td>
<td class="hits"></td>
<td class="source"><code>    end.</code></td>
</tr>
<tr>
<td class="line" id="L180">180</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L181">181</td>
<td class="hits"></td>
<td class="source"><code>-spec backported_gen_server_stop(Conn, Reason, Timeout) -&gt; ok</code></td>
</tr>
<tr>
<td class="line" id="L182">182</td>
<td class="hits"></td>
<td class="source"><code>    when Conn :: connection(),</code></td>
</tr>
<tr>
<td class="line" id="L183">183</td>
<td class="hits"></td>
<td class="source"><code>         Reason :: term(),</code></td>
</tr>
<tr>
<td class="line" id="L184">184</td>
<td class="hits"></td>
<td class="source"><code>         Timeout :: timeout().</code></td>
</tr>
<tr>
<td class="line" id="L185">185</td>
<td class="hits"></td>
<td class="source"><code>backported_gen_server_stop(Conn, Reason, Timeout) -&gt;</code></td>
</tr>
<tr class="miss">
<td class="line" id="L186">186</td>
<td class="hits">0</td>
<td class="source"><code>    Monitor=monitor(process, Conn),</code></td>
</tr>
<tr class="miss">
<td class="line" id="L187">187</td>
<td class="hits">0</td>
<td class="source"><code>    exit(Conn, Reason),</code></td>
</tr>
<tr class="miss">
<td class="line" id="L188">188</td>
<td class="hits">0</td>
<td class="source"><code>    receive</code></td>
</tr>
<tr>
<td class="line" id="L189">189</td>
<td class="hits"></td>
<td class="source"><code>        {'DOWN', Monitor, process, Conn, Reason} -&gt;</code></td>
</tr>
<tr class="miss">
<td class="line" id="L190">190</td>
<td class="hits">0</td>
<td class="source"><code>            ok;</code></td>
</tr>
<tr>
<td class="line" id="L191">191</td>
<td class="hits"></td>
<td class="source"><code>        {'DOWN', Monitor, process, Conn, UnexpectedReason} -&gt;</code></td>
</tr>
<tr class="miss">
<td class="line" id="L192">192</td>
<td class="hits">0</td>
<td class="source"><code>            exit(UnexpectedReason)</code></td>
</tr>
<tr>
<td class="line" id="L193">193</td>
<td class="hits"></td>
<td class="source"><code>    after Timeout -&gt;</code></td>
</tr>
<tr class="miss">
<td class="line" id="L194">194</td>
<td class="hits">0</td>
<td class="source"><code>        exit(Conn, kill),</code></td>
</tr>
<tr class="miss">
<td class="line" id="L195">195</td>
<td class="hits">0</td>
<td class="source"><code>        receive</code></td>
</tr>
<tr>
<td class="line" id="L196">196</td>
<td class="hits"></td>
<td class="source"><code>            {'DOWN', Monitor, process, Conn, killed} -&gt;</code></td>
</tr>
<tr class="miss">
<td class="line" id="L197">197</td>
<td class="hits">0</td>
<td class="source"><code>                exit(timeout)</code></td>
</tr>
<tr>
<td class="line" id="L198">198</td>
<td class="hits"></td>
<td class="source"><code>        end</code></td>
</tr>
<tr>
<td class="line" id="L199">199</td>
<td class="hits"></td>
<td class="source"><code>    end.</code></td>
</tr>
<tr>
<td class="line" id="L200">200</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L201">201</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L202">202</td>
<td class="hits"></td>
<td class="source"><code>%% @see query/5.</code></td>
</tr>
<tr>
<td class="line" id="L203">203</td>
<td class="hits"></td>
<td class="source"><code>-spec query(Conn, Query) -&gt; Result</code></td>
</tr>
<tr>
<td class="line" id="L204">204</td>
<td class="hits"></td>
<td class="source"><code>    when Conn :: connection(),</code></td>
</tr>
<tr>
<td class="line" id="L205">205</td>
<td class="hits"></td>
<td class="source"><code>         Query :: iodata(),</code></td>
</tr>
<tr>
<td class="line" id="L206">206</td>
<td class="hits"></td>
<td class="source"><code>         Result :: query_result().</code></td>
</tr>
<tr>
<td class="line" id="L207">207</td>
<td class="hits"></td>
<td class="source"><code>query(Conn, Query) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L208">208</td>
<td class="hits">421</td>
<td class="source"><code>    query(Conn, Query, no_params, no_filtermap_fun, default_timeout).</code></td>
</tr>
<tr>
<td class="line" id="L209">209</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L210">210</td>
<td class="hits"></td>
<td class="source"><code>%% @see query/5.</code></td>
</tr>
<tr>
<td class="line" id="L211">211</td>
<td class="hits"></td>
<td class="source"><code>-spec query(Conn, Query, Params | FilterMap | Timeout) -&gt; Result</code></td>
</tr>
<tr>
<td class="line" id="L212">212</td>
<td class="hits"></td>
<td class="source"><code>    when Conn :: connection(),</code></td>
</tr>
<tr>
<td class="line" id="L213">213</td>
<td class="hits"></td>
<td class="source"><code>         Query :: iodata(),</code></td>
</tr>
<tr>
<td class="line" id="L214">214</td>
<td class="hits"></td>
<td class="source"><code>         Timeout :: default_timeout | timeout(),</code></td>
</tr>
<tr>
<td class="line" id="L215">215</td>
<td class="hits"></td>
<td class="source"><code>         Params :: no_params | [term()],</code></td>
</tr>
<tr>
<td class="line" id="L216">216</td>
<td class="hits"></td>
<td class="source"><code>         FilterMap :: no_filtermap_fun | query_filtermap_fun(),</code></td>
</tr>
<tr>
<td class="line" id="L217">217</td>
<td class="hits"></td>
<td class="source"><code>         Result :: query_result().</code></td>
</tr>
<tr>
<td class="line" id="L218">218</td>
<td class="hits"></td>
<td class="source"><code>query(Conn, Query, Params) when Params == no_params;</code></td>
</tr>
<tr>
<td class="line" id="L219">219</td>
<td class="hits"></td>
<td class="source"><code>                                is_list(Params) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L220">220</td>
<td class="hits">10</td>
<td class="source"><code>    query(Conn, Query, Params, no_filtermap_fun, default_timeout);</code></td>
</tr>
<tr>
<td class="line" id="L221">221</td>
<td class="hits"></td>
<td class="source"><code>query(Conn, Query, FilterMap) when FilterMap == no_filtermap_fun;</code></td>
</tr>
<tr>
<td class="line" id="L222">222</td>
<td class="hits"></td>
<td class="source"><code>                                   is_function(FilterMap, 1);</code></td>
</tr>
<tr>
<td class="line" id="L223">223</td>
<td class="hits"></td>
<td class="source"><code>                                   is_function(FilterMap, 2) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L224">224</td>
<td class="hits">2</td>
<td class="source"><code>    query(Conn, Query, no_params, FilterMap, default_timeout);</code></td>
</tr>
<tr>
<td class="line" id="L225">225</td>
<td class="hits"></td>
<td class="source"><code>query(Conn, Query, Timeout) when Timeout == default_timeout;</code></td>
</tr>
<tr>
<td class="line" id="L226">226</td>
<td class="hits"></td>
<td class="source"><code>                                 is_integer(Timeout);</code></td>
</tr>
<tr>
<td class="line" id="L227">227</td>
<td class="hits"></td>
<td class="source"><code>                                 Timeout == infinity -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L228">228</td>
<td class="hits">2</td>
<td class="source"><code>    query(Conn, Query, no_params, no_filtermap_fun, Timeout).</code></td>
</tr>
<tr>
<td class="line" id="L229">229</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L230">230</td>
<td class="hits"></td>
<td class="source"><code>%% @see query/5.</code></td>
</tr>
<tr>
<td class="line" id="L231">231</td>
<td class="hits"></td>
<td class="source"><code>-spec query(Conn, Query, Params, Timeout) -&gt; Result</code></td>
</tr>
<tr>
<td class="line" id="L232">232</td>
<td class="hits"></td>
<td class="source"><code>        when Conn :: connection(),</code></td>
</tr>
<tr>
<td class="line" id="L233">233</td>
<td class="hits"></td>
<td class="source"><code>             Query :: iodata(),</code></td>
</tr>
<tr>
<td class="line" id="L234">234</td>
<td class="hits"></td>
<td class="source"><code>             Timeout :: default_timeout | timeout(),</code></td>
</tr>
<tr>
<td class="line" id="L235">235</td>
<td class="hits"></td>
<td class="source"><code>             Params :: no_params | [term()],</code></td>
</tr>
<tr>
<td class="line" id="L236">236</td>
<td class="hits"></td>
<td class="source"><code>             Result :: query_result();</code></td>
</tr>
<tr>
<td class="line" id="L237">237</td>
<td class="hits"></td>
<td class="source"><code>    (Conn, Query, FilterMap, Timeout) -&gt; Result</code></td>
</tr>
<tr>
<td class="line" id="L238">238</td>
<td class="hits"></td>
<td class="source"><code>        when Conn :: connection(),</code></td>
</tr>
<tr>
<td class="line" id="L239">239</td>
<td class="hits"></td>
<td class="source"><code>             Query :: iodata(),</code></td>
</tr>
<tr>
<td class="line" id="L240">240</td>
<td class="hits"></td>
<td class="source"><code>             Timeout :: default_timeout | timeout(),</code></td>
</tr>
<tr>
<td class="line" id="L241">241</td>
<td class="hits"></td>
<td class="source"><code>             FilterMap :: no_filtermap_fun | query_filtermap_fun(),</code></td>
</tr>
<tr>
<td class="line" id="L242">242</td>
<td class="hits"></td>
<td class="source"><code>             Result :: query_result();</code></td>
</tr>
<tr>
<td class="line" id="L243">243</td>
<td class="hits"></td>
<td class="source"><code>    (Conn, Query, Params, FilterMap) -&gt; Result</code></td>
</tr>
<tr>
<td class="line" id="L244">244</td>
<td class="hits"></td>
<td class="source"><code>        when Conn :: connection(),</code></td>
</tr>
<tr>
<td class="line" id="L245">245</td>
<td class="hits"></td>
<td class="source"><code>             Query :: iodata(),</code></td>
</tr>
<tr>
<td class="line" id="L246">246</td>
<td class="hits"></td>
<td class="source"><code>             Params :: no_params | [term()],</code></td>
</tr>
<tr>
<td class="line" id="L247">247</td>
<td class="hits"></td>
<td class="source"><code>             FilterMap :: no_filtermap_fun | query_filtermap_fun(),</code></td>
</tr>
<tr>
<td class="line" id="L248">248</td>
<td class="hits"></td>
<td class="source"><code>             Result :: query_result().</code></td>
</tr>
<tr>
<td class="line" id="L249">249</td>
<td class="hits"></td>
<td class="source"><code>query(Conn, Query, Params, Timeout) when (Params == no_params orelse</code></td>
</tr>
<tr>
<td class="line" id="L250">250</td>
<td class="hits"></td>
<td class="source"><code>                                          is_list(Params)) andalso</code></td>
</tr>
<tr>
<td class="line" id="L251">251</td>
<td class="hits"></td>
<td class="source"><code>                                         (Timeout == default_timeout orelse</code></td>
</tr>
<tr>
<td class="line" id="L252">252</td>
<td class="hits"></td>
<td class="source"><code>                                          is_integer(Timeout) orelse</code></td>
</tr>
<tr>
<td class="line" id="L253">253</td>
<td class="hits"></td>
<td class="source"><code>                                          Timeout == infinity) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L254">254</td>
<td class="hits">1</td>
<td class="source"><code>    query(Conn, Query, Params, no_filtermap_fun, Timeout);</code></td>
</tr>
<tr>
<td class="line" id="L255">255</td>
<td class="hits"></td>
<td class="source"><code>query(Conn, Query, FilterMap, Timeout) when (FilterMap == no_filtermap_fun orelse</code></td>
</tr>
<tr>
<td class="line" id="L256">256</td>
<td class="hits"></td>
<td class="source"><code>                                             is_function(FilterMap, 1) orelse</code></td>
</tr>
<tr>
<td class="line" id="L257">257</td>
<td class="hits"></td>
<td class="source"><code>                                             is_function(FilterMap, 2)) andalso</code></td>
</tr>
<tr>
<td class="line" id="L258">258</td>
<td class="hits"></td>
<td class="source"><code>                                            (Timeout == default_timeout orelse</code></td>
</tr>
<tr>
<td class="line" id="L259">259</td>
<td class="hits"></td>
<td class="source"><code>                                             is_integer(Timeout) orelse</code></td>
</tr>
<tr>
<td class="line" id="L260">260</td>
<td class="hits"></td>
<td class="source"><code>                                             Timeout=:=infinity) -&gt;</code></td>
</tr>
<tr class="miss">
<td class="line" id="L261">261</td>
<td class="hits">0</td>
<td class="source"><code>    query(Conn, Query, no_params, FilterMap, Timeout);</code></td>
</tr>
<tr>
<td class="line" id="L262">262</td>
<td class="hits"></td>
<td class="source"><code>query(Conn, Query, Params, FilterMap) when (Params == no_params orelse</code></td>
</tr>
<tr>
<td class="line" id="L263">263</td>
<td class="hits"></td>
<td class="source"><code>                                            is_list(Params)) andalso</code></td>
</tr>
<tr>
<td class="line" id="L264">264</td>
<td class="hits"></td>
<td class="source"><code>                                           (FilterMap == no_filtermap_fun orelse</code></td>
</tr>
<tr>
<td class="line" id="L265">265</td>
<td class="hits"></td>
<td class="source"><code>                                            is_function(FilterMap, 1) orelse</code></td>
</tr>
<tr>
<td class="line" id="L266">266</td>
<td class="hits"></td>
<td class="source"><code>                                            is_function(FilterMap, 2)) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L267">267</td>
<td class="hits">2</td>
<td class="source"><code>    query(Conn, Query, Params, FilterMap, default_timeout).</code></td>
</tr>
<tr>
<td class="line" id="L268">268</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L269">269</td>
<td class="hits"></td>
<td class="source"><code>%% @doc Executes a parameterized query with a timeout and applies a filter/map</code></td>
</tr>
<tr>
<td class="line" id="L270">270</td>
<td class="hits"></td>
<td class="source"><code>%% function to the result rows.</code></td>
</tr>
<tr>
<td class="line" id="L271">271</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L272">272</td>
<td class="hits"></td>
<td class="source"><code>%% A prepared statement is created, executed and then cached for a certain</code></td>
</tr>
<tr>
<td class="line" id="L273">273</td>
<td class="hits"></td>
<td class="source"><code>%% time. If the same query is executed again when it is already cached, it does</code></td>
</tr>
<tr>
<td class="line" id="L274">274</td>
<td class="hits"></td>
<td class="source"><code>%% not need to be prepared again.</code></td>
</tr>
<tr>
<td class="line" id="L275">275</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L276">276</td>
<td class="hits"></td>
<td class="source"><code>%% The minimum time the prepared statement is cached can be specified using the</code></td>
</tr>
<tr>
<td class="line" id="L277">277</td>
<td class="hits"></td>
<td class="source"><code>%% option `{query_cache_time, Milliseconds}' to start_link/1.</code></td>
</tr>
<tr>
<td class="line" id="L278">278</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L279">279</td>
<td class="hits"></td>
<td class="source"><code>%% Results are returned in the form `{ok, ColumnNames, Rows}' if there is one</code></td>
</tr>
<tr>
<td class="line" id="L280">280</td>
<td class="hits"></td>
<td class="source"><code>%% result set. If there are more than one result sets, they are returned in the</code></td>
</tr>
<tr>
<td class="line" id="L281">281</td>
<td class="hits"></td>
<td class="source"><code>%% form `{ok, [{ColumnNames, Rows}, ...]}'.</code></td>
</tr>
<tr>
<td class="line" id="L282">282</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L283">283</td>
<td class="hits"></td>
<td class="source"><code>%% For queries that don't return any rows (INSERT, UPDATE, etc.) only the atom</code></td>
</tr>
<tr>
<td class="line" id="L284">284</td>
<td class="hits"></td>
<td class="source"><code>%% `ok' is returned.</code></td>
</tr>
<tr>
<td class="line" id="L285">285</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L286">286</td>
<td class="hits"></td>
<td class="source"><code>%% The `Params', `FilterMap' and `Timeout' arguments are optional.</code></td>
</tr>
<tr>
<td class="line" id="L287">287</td>
<td class="hits"></td>
<td class="source"><code>%% &lt;ul&gt;</code></td>
</tr>
<tr>
<td class="line" id="L288">288</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;li&gt;If the `Params' argument is the atom `no_params' or is omitted, a plain</code></td>
</tr>
<tr>
<td class="line" id="L289">289</td>
<td class="hits"></td>
<td class="source"><code>%%       query will be executed instead of a parameterized one.&lt;/li&gt;</code></td>
</tr>
<tr>
<td class="line" id="L290">290</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;li&gt;If the `FilterMap' argument is the atom `no_filtermap_fun' or is</code></td>
</tr>
<tr>
<td class="line" id="L291">291</td>
<td class="hits"></td>
<td class="source"><code>%%       omitted, no row filtering/mapping will be applied and all result rows</code></td>
</tr>
<tr>
<td class="line" id="L292">292</td>
<td class="hits"></td>
<td class="source"><code>%%       will be returned unchanged.&lt;/li&gt;</code></td>
</tr>
<tr>
<td class="line" id="L293">293</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;li&gt;If the `Timeout' argument is the atom `default_timeout' or is omitted,</code></td>
</tr>
<tr>
<td class="line" id="L294">294</td>
<td class="hits"></td>
<td class="source"><code>%%       the timeout given in `start_link/1' is used.&lt;/li&gt;</code></td>
</tr>
<tr>
<td class="line" id="L295">295</td>
<td class="hits"></td>
<td class="source"><code>%% &lt;/ul&gt;</code></td>
</tr>
<tr>
<td class="line" id="L296">296</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L297">297</td>
<td class="hits"></td>
<td class="source"><code>%% If the `FilterMap' argument is used, it must be a function of arity 1 or 2</code></td>
</tr>
<tr>
<td class="line" id="L298">298</td>
<td class="hits"></td>
<td class="source"><code>%% that returns either `true', `false', or `{true, Value}'.</code></td>
</tr>
<tr>
<td class="line" id="L299">299</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L300">300</td>
<td class="hits"></td>
<td class="source"><code>%% Each result row is handed to the given function as soon as it is received</code></td>
</tr>
<tr>
<td class="line" id="L301">301</td>
<td class="hits"></td>
<td class="source"><code>%% from the server, and only when the function has returned, the next row is</code></td>
</tr>
<tr>
<td class="line" id="L302">302</td>
<td class="hits"></td>
<td class="source"><code>%% fetched. This provides the ability to prevent memory exhaustion; on the</code></td>
</tr>
<tr>
<td class="line" id="L303">303</td>
<td class="hits"></td>
<td class="source"><code>%% other hand, it can cause the server to time out on sending if your function</code></td>
</tr>
<tr>
<td class="line" id="L304">304</td>
<td class="hits"></td>
<td class="source"><code>%% is doing something slow (see the MySQL documentation on `NET_WRITE_TIMEOUT').</code></td>
</tr>
<tr>
<td class="line" id="L305">305</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L306">306</td>
<td class="hits"></td>
<td class="source"><code>%% If the function is of arity 1, only the row is passed to it as the single</code></td>
</tr>
<tr>
<td class="line" id="L307">307</td>
<td class="hits"></td>
<td class="source"><code>%% argument, while if the function is of arity 2, the column names are passed</code></td>
</tr>
<tr>
<td class="line" id="L308">308</td>
<td class="hits"></td>
<td class="source"><code>%% in as the first argument and the row as the second.</code></td>
</tr>
<tr>
<td class="line" id="L309">309</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L310">310</td>
<td class="hits"></td>
<td class="source"><code>%% The value returned is then used to decide if the row is to be included in</code></td>
</tr>
<tr>
<td class="line" id="L311">311</td>
<td class="hits"></td>
<td class="source"><code>%% the result(s) returned from the `query' call (filtering), or if something</code></td>
</tr>
<tr>
<td class="line" id="L312">312</td>
<td class="hits"></td>
<td class="source"><code>%% else is to be included in the result instead (mapping). You may also use</code></td>
</tr>
<tr>
<td class="line" id="L313">313</td>
<td class="hits"></td>
<td class="source"><code>%% this function for side effects, like writing rows to disk or sending them</code></td>
</tr>
<tr>
<td class="line" id="L314">314</td>
<td class="hits"></td>
<td class="source"><code>%% to another process etc.</code></td>
</tr>
<tr>
<td class="line" id="L315">315</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L316">316</td>
<td class="hits"></td>
<td class="source"><code>%% Here is an example showing some of the things that are possible:</code></td>
</tr>
<tr>
<td class="line" id="L317">317</td>
<td class="hits"></td>
<td class="source"><code>%% ```</code></td>
</tr>
<tr>
<td class="line" id="L318">318</td>
<td class="hits"></td>
<td class="source"><code>%% Query = "SELECT a, b, c FROM foo",</code></td>
</tr>
<tr>
<td class="line" id="L319">319</td>
<td class="hits"></td>
<td class="source"><code>%% FilterMap = fun</code></td>
</tr>
<tr>
<td class="line" id="L320">320</td>
<td class="hits"></td>
<td class="source"><code>%%     %% Include all rows where the first column is &lt; 10.</code></td>
</tr>
<tr>
<td class="line" id="L321">321</td>
<td class="hits"></td>
<td class="source"><code>%%     ([A|_]) when A &lt; 10 -&gt;</code></td>
</tr>
<tr>
<td class="line" id="L322">322</td>
<td class="hits"></td>
<td class="source"><code>%%         true;</code></td>
</tr>
<tr>
<td class="line" id="L323">323</td>
<td class="hits"></td>
<td class="source"><code>%%     %% Exclude all rows where the first column is &gt;= 10 and &lt; 20.</code></td>
</tr>
<tr>
<td class="line" id="L324">324</td>
<td class="hits"></td>
<td class="source"><code>%%     ([A|_]) when A &lt; 20 -&gt;</code></td>
</tr>
<tr>
<td class="line" id="L325">325</td>
<td class="hits"></td>
<td class="source"><code>%%         false;</code></td>
</tr>
<tr>
<td class="line" id="L326">326</td>
<td class="hits"></td>
<td class="source"><code>%%     %% For rows where the first column is &gt;= 20 and &lt; 30, include</code></td>
</tr>
<tr>
<td class="line" id="L327">327</td>
<td class="hits"></td>
<td class="source"><code>%%     %% the atom 'foo' in place of the row instead.</code></td>
</tr>
<tr>
<td class="line" id="L328">328</td>
<td class="hits"></td>
<td class="source"><code>%%     ([A|_]) when A &lt; 30 -&gt;</code></td>
</tr>
<tr>
<td class="line" id="L329">329</td>
<td class="hits"></td>
<td class="source"><code>%%         {true, foo}};</code></td>
</tr>
<tr>
<td class="line" id="L330">330</td>
<td class="hits"></td>
<td class="source"><code>%%     %% For rows where the first row is &gt;= 30 and &lt; 40, send the</code></td>
</tr>
<tr>
<td class="line" id="L331">331</td>
<td class="hits"></td>
<td class="source"><code>%%     %% row to a gen_server via call (ie, wait for a response),</code></td>
</tr>
<tr>
<td class="line" id="L332">332</td>
<td class="hits"></td>
<td class="source"><code>%%     %% and do not include the row in the result.</code></td>
</tr>
<tr>
<td class="line" id="L333">333</td>
<td class="hits"></td>
<td class="source"><code>%%     (R=[A|_]) when A &lt; 40 -&gt;</code></td>
</tr>
<tr>
<td class="line" id="L334">334</td>
<td class="hits"></td>
<td class="source"><code>%%         gen_server:call(Pid, R),</code></td>
</tr>
<tr>
<td class="line" id="L335">335</td>
<td class="hits"></td>
<td class="source"><code>%%         false;</code></td>
</tr>
<tr>
<td class="line" id="L336">336</td>
<td class="hits"></td>
<td class="source"><code>%%     %% For rows where the first column is &gt;= 40 and &lt; 50, send the</code></td>
</tr>
<tr>
<td class="line" id="L337">337</td>
<td class="hits"></td>
<td class="source"><code>%%     %% row to a gen_server via cast (ie, do not wait for a reply),</code></td>
</tr>
<tr>
<td class="line" id="L338">338</td>
<td class="hits"></td>
<td class="source"><code>%%     %% and include the row in the result, also.</code></td>
</tr>
<tr>
<td class="line" id="L339">339</td>
<td class="hits"></td>
<td class="source"><code>%%     (R=[A|_]) when A &lt; 50 -&gt;</code></td>
</tr>
<tr>
<td class="line" id="L340">340</td>
<td class="hits"></td>
<td class="source"><code>%%         gen_server:cast(Pid, R),</code></td>
</tr>
<tr>
<td class="line" id="L341">341</td>
<td class="hits"></td>
<td class="source"><code>%%         true;</code></td>
</tr>
<tr>
<td class="line" id="L342">342</td>
<td class="hits"></td>
<td class="source"><code>%%     %% Exclude all other rows from the result.</code></td>
</tr>
<tr>
<td class="line" id="L343">343</td>
<td class="hits"></td>
<td class="source"><code>%%     (_) -&gt;</code></td>
</tr>
<tr>
<td class="line" id="L344">344</td>
<td class="hits"></td>
<td class="source"><code>%%         false</code></td>
</tr>
<tr>
<td class="line" id="L345">345</td>
<td class="hits"></td>
<td class="source"><code>%% end,</code></td>
</tr>
<tr>
<td class="line" id="L346">346</td>
<td class="hits"></td>
<td class="source"><code>%% query(Conn, Query, no_params, FilterMap, default_timeout).</code></td>
</tr>
<tr>
<td class="line" id="L347">347</td>
<td class="hits"></td>
<td class="source"><code>%% '''</code></td>
</tr>
<tr>
<td class="line" id="L348">348</td>
<td class="hits"></td>
<td class="source"><code>-spec query(Conn, Query, Params, FilterMap, Timeout) -&gt; Result</code></td>
</tr>
<tr>
<td class="line" id="L349">349</td>
<td class="hits"></td>
<td class="source"><code>    when Conn :: connection(),</code></td>
</tr>
<tr>
<td class="line" id="L350">350</td>
<td class="hits"></td>
<td class="source"><code>         Query :: iodata(),</code></td>
</tr>
<tr>
<td class="line" id="L351">351</td>
<td class="hits"></td>
<td class="source"><code>         Timeout :: default_timeout | timeout(),</code></td>
</tr>
<tr>
<td class="line" id="L352">352</td>
<td class="hits"></td>
<td class="source"><code>         Params :: no_params | [term()],</code></td>
</tr>
<tr>
<td class="line" id="L353">353</td>
<td class="hits"></td>
<td class="source"><code>         FilterMap :: no_filtermap_fun | query_filtermap_fun(),</code></td>
</tr>
<tr>
<td class="line" id="L354">354</td>
<td class="hits"></td>
<td class="source"><code>         Result :: query_result().</code></td>
</tr>
<tr>
<td class="line" id="L355">355</td>
<td class="hits"></td>
<td class="source"><code>query(Conn, Query, no_params, FilterMap, Timeout) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L356">356</td>
<td class="hits">425</td>
<td class="source"><code>    query_call(Conn, {query, Query, FilterMap, Timeout});</code></td>
</tr>
<tr>
<td class="line" id="L357">357</td>
<td class="hits"></td>
<td class="source"><code>query(Conn, Query, Params, FilterMap, Timeout) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L358">358</td>
<td class="hits">13</td>
<td class="source"><code>    case mysql_protocol:valid_params(Params) of</code></td>
</tr>
<tr>
<td class="line" id="L359">359</td>
<td class="hits"></td>
<td class="source"><code>        true -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L360">360</td>
<td class="hits">12</td>
<td class="source"><code>            query_call(Conn,</code></td>
</tr>
<tr>
<td class="line" id="L361">361</td>
<td class="hits"></td>
<td class="source"><code>                       {param_query, Query, Params, FilterMap, Timeout});</code></td>
</tr>
<tr>
<td class="line" id="L362">362</td>
<td class="hits"></td>
<td class="source"><code>        false -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L363">363</td>
<td class="hits">1</td>
<td class="source"><code>            error(badarg)</code></td>
</tr>
<tr>
<td class="line" id="L364">364</td>
<td class="hits"></td>
<td class="source"><code>    end.</code></td>
</tr>
<tr>
<td class="line" id="L365">365</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L366">366</td>
<td class="hits"></td>
<td class="source"><code>%% @doc Executes a prepared statement with the default query timeout as given</code></td>
</tr>
<tr>
<td class="line" id="L367">367</td>
<td class="hits"></td>
<td class="source"><code>%% to start_link/1.</code></td>
</tr>
<tr>
<td class="line" id="L368">368</td>
<td class="hits"></td>
<td class="source"><code>%% @see prepare/2</code></td>
</tr>
<tr>
<td class="line" id="L369">369</td>
<td class="hits"></td>
<td class="source"><code>%% @see prepare/3</code></td>
</tr>
<tr>
<td class="line" id="L370">370</td>
<td class="hits"></td>
<td class="source"><code>%% @see prepare/4</code></td>
</tr>
<tr>
<td class="line" id="L371">371</td>
<td class="hits"></td>
<td class="source"><code>%% @see execute/5</code></td>
</tr>
<tr>
<td class="line" id="L372">372</td>
<td class="hits"></td>
<td class="source"><code>-spec execute(Conn, StatementRef, Params) -&gt; Result | {error, not_prepared}</code></td>
</tr>
<tr>
<td class="line" id="L373">373</td>
<td class="hits"></td>
<td class="source"><code>  when Conn :: connection(),</code></td>
</tr>
<tr>
<td class="line" id="L374">374</td>
<td class="hits"></td>
<td class="source"><code>       StatementRef :: atom() | integer(),</code></td>
</tr>
<tr>
<td class="line" id="L375">375</td>
<td class="hits"></td>
<td class="source"><code>       Params :: [term()],</code></td>
</tr>
<tr>
<td class="line" id="L376">376</td>
<td class="hits"></td>
<td class="source"><code>       Result :: query_result().</code></td>
</tr>
<tr>
<td class="line" id="L377">377</td>
<td class="hits"></td>
<td class="source"><code>execute(Conn, StatementRef, Params) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L378">378</td>
<td class="hits">185</td>
<td class="source"><code>    execute(Conn, StatementRef, Params, no_filtermap_fun, default_timeout).</code></td>
</tr>
<tr>
<td class="line" id="L379">379</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L380">380</td>
<td class="hits"></td>
<td class="source"><code>%% @doc Executes a prepared statement.</code></td>
</tr>
<tr>
<td class="line" id="L381">381</td>
<td class="hits"></td>
<td class="source"><code>%% @see prepare/2</code></td>
</tr>
<tr>
<td class="line" id="L382">382</td>
<td class="hits"></td>
<td class="source"><code>%% @see prepare/3</code></td>
</tr>
<tr>
<td class="line" id="L383">383</td>
<td class="hits"></td>
<td class="source"><code>%% @see prepare/4</code></td>
</tr>
<tr>
<td class="line" id="L384">384</td>
<td class="hits"></td>
<td class="source"><code>%% @see execute/5</code></td>
</tr>
<tr>
<td class="line" id="L385">385</td>
<td class="hits"></td>
<td class="source"><code>-spec execute(Conn, StatementRef, Params, FilterMap | Timeout) -&gt;</code></td>
</tr>
<tr>
<td class="line" id="L386">386</td>
<td class="hits"></td>
<td class="source"><code>    Result | {error, not_prepared}</code></td>
</tr>
<tr>
<td class="line" id="L387">387</td>
<td class="hits"></td>
<td class="source"><code>  when Conn :: connection(),</code></td>
</tr>
<tr>
<td class="line" id="L388">388</td>
<td class="hits"></td>
<td class="source"><code>       StatementRef :: atom() | integer(),</code></td>
</tr>
<tr>
<td class="line" id="L389">389</td>
<td class="hits"></td>
<td class="source"><code>       Params :: [term()],</code></td>
</tr>
<tr>
<td class="line" id="L390">390</td>
<td class="hits"></td>
<td class="source"><code>       FilterMap :: no_filtermap_fun | query_filtermap_fun(),</code></td>
</tr>
<tr>
<td class="line" id="L391">391</td>
<td class="hits"></td>
<td class="source"><code>       Timeout :: default_timeout | timeout(),</code></td>
</tr>
<tr>
<td class="line" id="L392">392</td>
<td class="hits"></td>
<td class="source"><code>       Result :: query_result().</code></td>
</tr>
<tr>
<td class="line" id="L393">393</td>
<td class="hits"></td>
<td class="source"><code>execute(Conn, StatementRef, Params, Timeout) when Timeout == default_timeout;</code></td>
</tr>
<tr>
<td class="line" id="L394">394</td>
<td class="hits"></td>
<td class="source"><code>                                                  is_integer(Timeout);</code></td>
</tr>
<tr>
<td class="line" id="L395">395</td>
<td class="hits"></td>
<td class="source"><code>                                                  Timeout=:=infinity -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L396">396</td>
<td class="hits">1</td>
<td class="source"><code>    execute(Conn, StatementRef, Params, no_filtermap_fun, Timeout);</code></td>
</tr>
<tr>
<td class="line" id="L397">397</td>
<td class="hits"></td>
<td class="source"><code>execute(Conn, StatementRef, Params, FilterMap) when FilterMap == no_filtermap_fun;</code></td>
</tr>
<tr>
<td class="line" id="L398">398</td>
<td class="hits"></td>
<td class="source"><code>                                                    is_function(FilterMap, 1);</code></td>
</tr>
<tr>
<td class="line" id="L399">399</td>
<td class="hits"></td>
<td class="source"><code>                                                    is_function(FilterMap, 2) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L400">400</td>
<td class="hits">2</td>
<td class="source"><code>    execute(Conn, StatementRef, Params, FilterMap, default_timeout).</code></td>
</tr>
<tr>
<td class="line" id="L401">401</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L402">402</td>
<td class="hits"></td>
<td class="source"><code>%% @doc Executes a prepared statement.</code></td>
</tr>
<tr>
<td class="line" id="L403">403</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L404">404</td>
<td class="hits"></td>
<td class="source"><code>%% The `FilterMap' and `Timeout' arguments are optional.</code></td>
</tr>
<tr>
<td class="line" id="L405">405</td>
<td class="hits"></td>
<td class="source"><code>%% &lt;ul&gt;</code></td>
</tr>
<tr>
<td class="line" id="L406">406</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;li&gt;If the `FilterMap' argument is the atom `no_filtermap_fun' or is</code></td>
</tr>
<tr>
<td class="line" id="L407">407</td>
<td class="hits"></td>
<td class="source"><code>%%       omitted, no row filtering/mapping will be applied and all result rows</code></td>
</tr>
<tr>
<td class="line" id="L408">408</td>
<td class="hits"></td>
<td class="source"><code>%%       will be returned unchanged.&lt;/li&gt;</code></td>
</tr>
<tr>
<td class="line" id="L409">409</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;li&gt;If the `Timeout' argument is the atom `default_timeout' or is omitted,</code></td>
</tr>
<tr>
<td class="line" id="L410">410</td>
<td class="hits"></td>
<td class="source"><code>%%       the timeout given in `start_link/1' is used.&lt;/li&gt;</code></td>
</tr>
<tr>
<td class="line" id="L411">411</td>
<td class="hits"></td>
<td class="source"><code>%% &lt;/ul&gt;</code></td>
</tr>
<tr>
<td class="line" id="L412">412</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L413">413</td>
<td class="hits"></td>
<td class="source"><code>%% See `query/5' for an explanation of the `FilterMap' argument.</code></td>
</tr>
<tr>
<td class="line" id="L414">414</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L415">415</td>
<td class="hits"></td>
<td class="source"><code>%% @see prepare/2</code></td>
</tr>
<tr>
<td class="line" id="L416">416</td>
<td class="hits"></td>
<td class="source"><code>%% @see prepare/3</code></td>
</tr>
<tr>
<td class="line" id="L417">417</td>
<td class="hits"></td>
<td class="source"><code>%% @see prepare/4</code></td>
</tr>
<tr>
<td class="line" id="L418">418</td>
<td class="hits"></td>
<td class="source"><code>%% @see query/5</code></td>
</tr>
<tr>
<td class="line" id="L419">419</td>
<td class="hits"></td>
<td class="source"><code>-spec execute(Conn, StatementRef, Params, FilterMap, Timeout) -&gt;</code></td>
</tr>
<tr>
<td class="line" id="L420">420</td>
<td class="hits"></td>
<td class="source"><code>    Result | {error, not_prepared}</code></td>
</tr>
<tr>
<td class="line" id="L421">421</td>
<td class="hits"></td>
<td class="source"><code>  when Conn :: connection(),</code></td>
</tr>
<tr>
<td class="line" id="L422">422</td>
<td class="hits"></td>
<td class="source"><code>       StatementRef :: atom() | integer(),</code></td>
</tr>
<tr>
<td class="line" id="L423">423</td>
<td class="hits"></td>
<td class="source"><code>       Params :: [term()],</code></td>
</tr>
<tr>
<td class="line" id="L424">424</td>
<td class="hits"></td>
<td class="source"><code>       FilterMap :: no_filtermap_fun | query_filtermap_fun(),</code></td>
</tr>
<tr>
<td class="line" id="L425">425</td>
<td class="hits"></td>
<td class="source"><code>       Timeout :: default_timeout | timeout(),</code></td>
</tr>
<tr>
<td class="line" id="L426">426</td>
<td class="hits"></td>
<td class="source"><code>       Result :: query_result().</code></td>
</tr>
<tr>
<td class="line" id="L427">427</td>
<td class="hits"></td>
<td class="source"><code>execute(Conn, StatementRef, Params, FilterMap, Timeout) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L428">428</td>
<td class="hits">188</td>
<td class="source"><code>    case mysql_protocol:valid_params(Params) of</code></td>
</tr>
<tr>
<td class="line" id="L429">429</td>
<td class="hits"></td>
<td class="source"><code>        true -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L430">430</td>
<td class="hits">187</td>
<td class="source"><code>            query_call(Conn,</code></td>
</tr>
<tr>
<td class="line" id="L431">431</td>
<td class="hits"></td>
<td class="source"><code>                       {execute, StatementRef, Params, FilterMap, Timeout});</code></td>
</tr>
<tr>
<td class="line" id="L432">432</td>
<td class="hits"></td>
<td class="source"><code>        false -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L433">433</td>
<td class="hits">1</td>
<td class="source"><code>            error(badarg)</code></td>
</tr>
<tr>
<td class="line" id="L434">434</td>
<td class="hits"></td>
<td class="source"><code>    end.</code></td>
</tr>
<tr>
<td class="line" id="L435">435</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L436">436</td>
<td class="hits"></td>
<td class="source"><code>%% @doc Creates a prepared statement from the passed query.</code></td>
</tr>
<tr>
<td class="line" id="L437">437</td>
<td class="hits"></td>
<td class="source"><code>%% @see prepare/3</code></td>
</tr>
<tr>
<td class="line" id="L438">438</td>
<td class="hits"></td>
<td class="source"><code>-spec prepare(Conn, Query) -&gt; {ok, StatementId} | {error, Reason}</code></td>
</tr>
<tr>
<td class="line" id="L439">439</td>
<td class="hits"></td>
<td class="source"><code>  when Conn :: connection(),</code></td>
</tr>
<tr>
<td class="line" id="L440">440</td>
<td class="hits"></td>
<td class="source"><code>       Query :: iodata(),</code></td>
</tr>
<tr>
<td class="line" id="L441">441</td>
<td class="hits"></td>
<td class="source"><code>       StatementId :: integer(),</code></td>
</tr>
<tr>
<td class="line" id="L442">442</td>
<td class="hits"></td>
<td class="source"><code>       Reason :: server_reason().</code></td>
</tr>
<tr>
<td class="line" id="L443">443</td>
<td class="hits"></td>
<td class="source"><code>prepare(Conn, Query) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L444">444</td>
<td class="hits">93</td>
<td class="source"><code>    gen_server:call(Conn, {prepare, Query}).</code></td>
</tr>
<tr>
<td class="line" id="L445">445</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L446">446</td>
<td class="hits"></td>
<td class="source"><code>%% @doc Creates a prepared statement from the passed query and associates it</code></td>
</tr>
<tr>
<td class="line" id="L447">447</td>
<td class="hits"></td>
<td class="source"><code>%% with the given name.</code></td>
</tr>
<tr>
<td class="line" id="L448">448</td>
<td class="hits"></td>
<td class="source"><code>%% @see prepare/2</code></td>
</tr>
<tr>
<td class="line" id="L449">449</td>
<td class="hits"></td>
<td class="source"><code>-spec prepare(Conn, Name, Query) -&gt; {ok, Name} | {error, Reason}</code></td>
</tr>
<tr>
<td class="line" id="L450">450</td>
<td class="hits"></td>
<td class="source"><code>  when Conn :: connection(),</code></td>
</tr>
<tr>
<td class="line" id="L451">451</td>
<td class="hits"></td>
<td class="source"><code>       Name :: atom(),</code></td>
</tr>
<tr>
<td class="line" id="L452">452</td>
<td class="hits"></td>
<td class="source"><code>       Query :: iodata(),</code></td>
</tr>
<tr>
<td class="line" id="L453">453</td>
<td class="hits"></td>
<td class="source"><code>       Reason :: server_reason().</code></td>
</tr>
<tr>
<td class="line" id="L454">454</td>
<td class="hits"></td>
<td class="source"><code>prepare(Conn, Name, Query) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L455">455</td>
<td class="hits">7</td>
<td class="source"><code>    gen_server:call(Conn, {prepare, Name, Query}).</code></td>
</tr>
<tr>
<td class="line" id="L456">456</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L457">457</td>
<td class="hits"></td>
<td class="source"><code>%% @doc Deallocates a prepared statement.</code></td>
</tr>
<tr>
<td class="line" id="L458">458</td>
<td class="hits"></td>
<td class="source"><code>-spec unprepare(Conn, StatementRef) -&gt; ok | {error, Reason}</code></td>
</tr>
<tr>
<td class="line" id="L459">459</td>
<td class="hits"></td>
<td class="source"><code>  when Conn :: connection(),</code></td>
</tr>
<tr>
<td class="line" id="L460">460</td>
<td class="hits"></td>
<td class="source"><code>       StatementRef :: atom() | integer(),</code></td>
</tr>
<tr>
<td class="line" id="L461">461</td>
<td class="hits"></td>
<td class="source"><code>       Reason :: server_reason() | not_prepared.</code></td>
</tr>
<tr>
<td class="line" id="L462">462</td>
<td class="hits"></td>
<td class="source"><code>unprepare(Conn, StatementRef) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L463">463</td>
<td class="hits">91</td>
<td class="source"><code>    gen_server:call(Conn, {unprepare, StatementRef}).</code></td>
</tr>
<tr>
<td class="line" id="L464">464</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L465">465</td>
<td class="hits"></td>
<td class="source"><code>%% @doc Returns the number of warnings generated by the last query/2 or</code></td>
</tr>
<tr>
<td class="line" id="L466">466</td>
<td class="hits"></td>
<td class="source"><code>%% execute/3 calls.</code></td>
</tr>
<tr>
<td class="line" id="L467">467</td>
<td class="hits"></td>
<td class="source"><code>-spec warning_count(connection()) -&gt; integer().</code></td>
</tr>
<tr>
<td class="line" id="L468">468</td>
<td class="hits"></td>
<td class="source"><code>warning_count(Conn) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L469">469</td>
<td class="hits">2</td>
<td class="source"><code>    gen_server:call(Conn, warning_count).</code></td>
</tr>
<tr>
<td class="line" id="L470">470</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L471">471</td>
<td class="hits"></td>
<td class="source"><code>%% @doc Returns the number of inserted, updated and deleted rows of the last</code></td>
</tr>
<tr>
<td class="line" id="L472">472</td>
<td class="hits"></td>
<td class="source"><code>%% executed query or prepared statement. If found_rows is set on the</code></td>
</tr>
<tr>
<td class="line" id="L473">473</td>
<td class="hits"></td>
<td class="source"><code>%% connection, for update operation the return value will equal to the number</code></td>
</tr>
<tr>
<td class="line" id="L474">474</td>
<td class="hits"></td>
<td class="source"><code>%% of rows matched by the query.</code></td>
</tr>
<tr>
<td class="line" id="L475">475</td>
<td class="hits"></td>
<td class="source"><code>-spec affected_rows(connection()) -&gt; integer().</code></td>
</tr>
<tr>
<td class="line" id="L476">476</td>
<td class="hits"></td>
<td class="source"><code>affected_rows(Conn) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L477">477</td>
<td class="hits">3</td>
<td class="source"><code>    gen_server:call(Conn, affected_rows).</code></td>
</tr>
<tr>
<td class="line" id="L478">478</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L479">479</td>
<td class="hits"></td>
<td class="source"><code>%% @doc Returns true if auto-commit is enabled and false otherwise.</code></td>
</tr>
<tr>
<td class="line" id="L480">480</td>
<td class="hits"></td>
<td class="source"><code>-spec autocommit(connection()) -&gt; boolean().</code></td>
</tr>
<tr>
<td class="line" id="L481">481</td>
<td class="hits"></td>
<td class="source"><code>autocommit(Conn) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L482">482</td>
<td class="hits">3</td>
<td class="source"><code>    gen_server:call(Conn, autocommit).</code></td>
</tr>
<tr>
<td class="line" id="L483">483</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L484">484</td>
<td class="hits"></td>
<td class="source"><code>%% @doc Returns the last insert-id.</code></td>
</tr>
<tr>
<td class="line" id="L485">485</td>
<td class="hits"></td>
<td class="source"><code>-spec insert_id(connection()) -&gt; integer().</code></td>
</tr>
<tr>
<td class="line" id="L486">486</td>
<td class="hits"></td>
<td class="source"><code>insert_id(Conn) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L487">487</td>
<td class="hits">3</td>
<td class="source"><code>    gen_server:call(Conn, insert_id).</code></td>
</tr>
<tr>
<td class="line" id="L488">488</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L489">489</td>
<td class="hits"></td>
<td class="source"><code>%% @doc Returns true if the connection is in a transaction and false otherwise.</code></td>
</tr>
<tr>
<td class="line" id="L490">490</td>
<td class="hits"></td>
<td class="source"><code>%% This works regardless of whether the transaction has been started using</code></td>
</tr>
<tr>
<td class="line" id="L491">491</td>
<td class="hits"></td>
<td class="source"><code>%% transaction/2,3 or using a plain `mysql:query(Connection, "BEGIN")'.</code></td>
</tr>
<tr>
<td class="line" id="L492">492</td>
<td class="hits"></td>
<td class="source"><code>%% @see transaction/2</code></td>
</tr>
<tr>
<td class="line" id="L493">493</td>
<td class="hits"></td>
<td class="source"><code>%% @see transaction/4</code></td>
</tr>
<tr>
<td class="line" id="L494">494</td>
<td class="hits"></td>
<td class="source"><code>-spec in_transaction(connection()) -&gt; boolean().</code></td>
</tr>
<tr>
<td class="line" id="L495">495</td>
<td class="hits"></td>
<td class="source"><code>in_transaction(Conn) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L496">496</td>
<td class="hits">25</td>
<td class="source"><code>    gen_server:call(Conn, in_transaction).</code></td>
</tr>
<tr>
<td class="line" id="L497">497</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L498">498</td>
<td class="hits"></td>
<td class="source"><code>%% @doc This function executes the functional object Fun as a transaction.</code></td>
</tr>
<tr>
<td class="line" id="L499">499</td>
<td class="hits"></td>
<td class="source"><code>%% @see transaction/4</code></td>
</tr>
<tr>
<td class="line" id="L500">500</td>
<td class="hits"></td>
<td class="source"><code>-spec transaction(connection(), fun()) -&gt; {atomic, term()} | {aborted, term()}.</code></td>
</tr>
<tr>
<td class="line" id="L501">501</td>
<td class="hits"></td>
<td class="source"><code>transaction(Conn, Fun) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L502">502</td>
<td class="hits">24</td>
<td class="source"><code>    transaction(Conn, Fun, [], infinity).</code></td>
</tr>
<tr>
<td class="line" id="L503">503</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L504">504</td>
<td class="hits"></td>
<td class="source"><code>%% @doc This function executes the functional object Fun as a transaction.</code></td>
</tr>
<tr>
<td class="line" id="L505">505</td>
<td class="hits"></td>
<td class="source"><code>%% @see transaction/4</code></td>
</tr>
<tr>
<td class="line" id="L506">506</td>
<td class="hits"></td>
<td class="source"><code>-spec transaction(connection(), fun(), Retries) -&gt; {atomic, term()} |</code></td>
</tr>
<tr>
<td class="line" id="L507">507</td>
<td class="hits"></td>
<td class="source"><code>                                                   {aborted, term()}</code></td>
</tr>
<tr>
<td class="line" id="L508">508</td>
<td class="hits"></td>
<td class="source"><code>    when Retries :: non_neg_integer() | infinity.</code></td>
</tr>
<tr>
<td class="line" id="L509">509</td>
<td class="hits"></td>
<td class="source"><code>transaction(Conn, Fun, Retries) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L510">510</td>
<td class="hits">4</td>
<td class="source"><code>    transaction(Conn, Fun, [], Retries).</code></td>
</tr>
<tr>
<td class="line" id="L511">511</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L512">512</td>
<td class="hits"></td>
<td class="source"><code>%% @doc This function executes the functional object Fun with arguments Args as</code></td>
</tr>
<tr>
<td class="line" id="L513">513</td>
<td class="hits"></td>
<td class="source"><code>%% a transaction.</code></td>
</tr>
<tr>
<td class="line" id="L514">514</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L515">515</td>
<td class="hits"></td>
<td class="source"><code>%% The semantics are as close as possible to mnesia's transactions. Transactions</code></td>
</tr>
<tr>
<td class="line" id="L516">516</td>
<td class="hits"></td>
<td class="source"><code>%% can be nested and are restarted automatically when deadlocks are detected.</code></td>
</tr>
<tr>
<td class="line" id="L517">517</td>
<td class="hits"></td>
<td class="source"><code>%% MySQL's savepoints are used to implement nested transactions.</code></td>
</tr>
<tr>
<td class="line" id="L518">518</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L519">519</td>
<td class="hits"></td>
<td class="source"><code>%% Fun must be a function and Args must be a list of the same length as the</code></td>
</tr>
<tr>
<td class="line" id="L520">520</td>
<td class="hits"></td>
<td class="source"><code>%% arity of Fun.</code></td>
</tr>
<tr>
<td class="line" id="L521">521</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L522">522</td>
<td class="hits"></td>
<td class="source"><code>%% If an exception occurs within Fun, the exception is caught and `{aborted,</code></td>
</tr>
<tr>
<td class="line" id="L523">523</td>
<td class="hits"></td>
<td class="source"><code>%% Reason}' is returned. The value of `Reason' depends on the class of the</code></td>
</tr>
<tr>
<td class="line" id="L524">524</td>
<td class="hits"></td>
<td class="source"><code>%% exception.</code></td>
</tr>
<tr>
<td class="line" id="L525">525</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L526">526</td>
<td class="hits"></td>
<td class="source"><code>%% Note that an error response from a query does not cause a transaction to be</code></td>
</tr>
<tr>
<td class="line" id="L527">527</td>
<td class="hits"></td>
<td class="source"><code>%% rollbacked. To force a rollback on a MySQL error you can trigger a `badmatch'</code></td>
</tr>
<tr>
<td class="line" id="L528">528</td>
<td class="hits"></td>
<td class="source"><code>%% using e.g. `ok = mysql:query(Pid, "SELECT some_non_existent_value")'. An</code></td>
</tr>
<tr>
<td class="line" id="L529">529</td>
<td class="hits"></td>
<td class="source"><code>%% exception to this is the error 1213 "Deadlock", after the specified number</code></td>
</tr>
<tr>
<td class="line" id="L530">530</td>
<td class="hits"></td>
<td class="source"><code>%% of retries, all failed. In this case, the transaction is aborted and the</code></td>
</tr>
<tr>
<td class="line" id="L531">531</td>
<td class="hits"></td>
<td class="source"><code>%% error is retured as the reason for the aborted transaction, along with a</code></td>
</tr>
<tr>
<td class="line" id="L532">532</td>
<td class="hits"></td>
<td class="source"><code>%% stacktrace pointing to where the last deadlock was detected. (In earlier</code></td>
</tr>
<tr>
<td class="line" id="L533">533</td>
<td class="hits"></td>
<td class="source"><code>%% versions, up to and including 1.3.2, transactions where automatically</code></td>
</tr>
<tr>
<td class="line" id="L534">534</td>
<td class="hits"></td>
<td class="source"><code>%% restarted also for the error 1205 "Lock wait timeout". This is no longer the</code></td>
</tr>
<tr>
<td class="line" id="L535">535</td>
<td class="hits"></td>
<td class="source"><code>%% case.)</code></td>
</tr>
<tr>
<td class="line" id="L536">536</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L537">537</td>
<td class="hits"></td>
<td class="source"><code>%% Some queries such as ALTER TABLE cause an *implicit commit* on the server.</code></td>
</tr>
<tr>
<td class="line" id="L538">538</td>
<td class="hits"></td>
<td class="source"><code>%% If such a query is executed within a transaction, an error on the form</code></td>
</tr>
<tr>
<td class="line" id="L539">539</td>
<td class="hits"></td>
<td class="source"><code>%% `{implicit_commit, Query}' is raised. This means that the transaction has</code></td>
</tr>
<tr>
<td class="line" id="L540">540</td>
<td class="hits"></td>
<td class="source"><code>%% been committed prematurely. This also happens if an explicit COMMIT is</code></td>
</tr>
<tr>
<td class="line" id="L541">541</td>
<td class="hits"></td>
<td class="source"><code>%% executed as a plain query within a managed transaction. (Don't do that!)</code></td>
</tr>
<tr>
<td class="line" id="L542">542</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L543">543</td>
<td class="hits"></td>
<td class="source"><code>%% &lt;table&gt;</code></td>
</tr>
<tr>
<td class="line" id="L544">544</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;thead&gt;</code></td>
</tr>
<tr>
<td class="line" id="L545">545</td>
<td class="hits"></td>
<td class="source"><code>%%     &lt;tr&gt;&lt;th&gt;Class of exception&lt;/th&gt;&lt;th&gt;Return value&lt;/th&gt;&lt;/tr&gt;</code></td>
</tr>
<tr>
<td class="line" id="L546">546</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;/thead&gt;</code></td>
</tr>
<tr>
<td class="line" id="L547">547</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;tbody&gt;</code></td>
</tr>
<tr>
<td class="line" id="L548">548</td>
<td class="hits"></td>
<td class="source"><code>%%     &lt;tr&gt;</code></td>
</tr>
<tr>
<td class="line" id="L549">549</td>
<td class="hits"></td>
<td class="source"><code>%%       &lt;td&gt;`error' with reason `ErrorReason'&lt;/td&gt;</code></td>
</tr>
<tr>
<td class="line" id="L550">550</td>
<td class="hits"></td>
<td class="source"><code>%%       &lt;td&gt;`{aborted, {ErrorReason, Stack}}'&lt;/td&gt;</code></td>
</tr>
<tr>
<td class="line" id="L551">551</td>
<td class="hits"></td>
<td class="source"><code>%%     &lt;/tr&gt;</code></td>
</tr>
<tr>
<td class="line" id="L552">552</td>
<td class="hits"></td>
<td class="source"><code>%%     &lt;tr&gt;&lt;td&gt;`exit(Term)'&lt;/td&gt;&lt;td&gt;`{aborted, Term}'&lt;/td&gt;&lt;/tr&gt;</code></td>
</tr>
<tr>
<td class="line" id="L553">553</td>
<td class="hits"></td>
<td class="source"><code>%%     &lt;tr&gt;&lt;td&gt;`throw(Term)'&lt;/td&gt;&lt;td&gt;`{aborted, {throw, Term}}'&lt;/td&gt;&lt;/tr&gt;</code></td>
</tr>
<tr>
<td class="line" id="L554">554</td>
<td class="hits"></td>
<td class="source"><code>%%   &lt;/tbody&gt;</code></td>
</tr>
<tr>
<td class="line" id="L555">555</td>
<td class="hits"></td>
<td class="source"><code>%% &lt;/table&gt;</code></td>
</tr>
<tr>
<td class="line" id="L556">556</td>
<td class="hits"></td>
<td class="source"><code>-spec transaction(connection(), fun(), list(), Retries) -&gt; {atomic, term()} |</code></td>
</tr>
<tr>
<td class="line" id="L557">557</td>
<td class="hits"></td>
<td class="source"><code>                                                           {aborted, term()}</code></td>
</tr>
<tr>
<td class="line" id="L558">558</td>
<td class="hits"></td>
<td class="source"><code>    when Retries :: non_neg_integer() | infinity.</code></td>
</tr>
<tr>
<td class="line" id="L559">559</td>
<td class="hits"></td>
<td class="source"><code>transaction(Conn, Fun, Args, Retries) when is_list(Args),</code></td>
</tr>
<tr>
<td class="line" id="L560">560</td>
<td class="hits"></td>
<td class="source"><code>                                           is_function(Fun, length(Args)) -&gt;</code></td>
</tr>
<tr>
<td class="line" id="L561">561</td>
<td class="hits"></td>
<td class="source"><code>    %% The guard makes sure that we can apply Fun to Args. Any error we catch</code></td>
</tr>
<tr>
<td class="line" id="L562">562</td>
<td class="hits"></td>
<td class="source"><code>    %% in the try-catch are actual errors that occurred in Fun.</code></td>
</tr>
<tr class="hit">
<td class="line" id="L563">563</td>
<td class="hits">28</td>
<td class="source"><code>    ok = gen_server:call(Conn, start_transaction, infinity),</code></td>
</tr>
<tr class="hit">
<td class="line" id="L564">564</td>
<td class="hits">28</td>
<td class="source"><code>    execute_transaction(Conn, Fun, Args, Retries).</code></td>
</tr>
<tr>
<td class="line" id="L565">565</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L566">566</td>
<td class="hits"></td>
<td class="source"><code>%% @private</code></td>
</tr>
<tr>
<td class="line" id="L567">567</td>
<td class="hits"></td>
<td class="source"><code>%% @doc This is a helper for transaction/2,3,4. It performs everything except</code></td>
</tr>
<tr>
<td class="line" id="L568">568</td>
<td class="hits"></td>
<td class="source"><code>%% executing the BEGIN statement. It is called recursively when a transaction</code></td>
</tr>
<tr>
<td class="line" id="L569">569</td>
<td class="hits"></td>
<td class="source"><code>%% is retried.</code></td>
</tr>
<tr>
<td class="line" id="L570">570</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L571">571</td>
<td class="hits"></td>
<td class="source"><code>%% "When a transaction rollback occurs due to a deadlock or lock wait timeout,</code></td>
</tr>
<tr>
<td class="line" id="L572">572</td>
<td class="hits"></td>
<td class="source"><code>%% it cancels the effect of the statements within the transaction. But if the</code></td>
</tr>
<tr>
<td class="line" id="L573">573</td>
<td class="hits"></td>
<td class="source"><code>%% start-transaction statement was START TRANSACTION or BEGIN statement,</code></td>
</tr>
<tr>
<td class="line" id="L574">574</td>
<td class="hits"></td>
<td class="source"><code>%% rollback does not cancel that statement."</code></td>
</tr>
<tr>
<td class="line" id="L575">575</td>
<td class="hits"></td>
<td class="source"><code>%% (https://dev.mysql.com/doc/refman/5.6/en/innodb-error-handling.html)</code></td>
</tr>
<tr>
<td class="line" id="L576">576</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L577">577</td>
<td class="hits"></td>
<td class="source"><code>%% Lock Wait Timeout:</code></td>
</tr>
<tr>
<td class="line" id="L578">578</td>
<td class="hits"></td>
<td class="source"><code>%% "InnoDB rolls back only the last statement on a transaction timeout by</code></td>
</tr>
<tr>
<td class="line" id="L579">579</td>
<td class="hits"></td>
<td class="source"><code>%% default. If --innodb_rollback_on_timeout is specified, a transaction timeout</code></td>
</tr>
<tr>
<td class="line" id="L580">580</td>
<td class="hits"></td>
<td class="source"><code>%% causes InnoDB to abort and roll back the entire transaction (the same</code></td>
</tr>
<tr>
<td class="line" id="L581">581</td>
<td class="hits"></td>
<td class="source"><code>%% behavior as in MySQL 4.1)."</code></td>
</tr>
<tr>
<td class="line" id="L582">582</td>
<td class="hits"></td>
<td class="source"><code>%% (https://dev.mysql.com/doc/refman/5.6/en/innodb-parameters.html)</code></td>
</tr>
<tr>
<td class="line" id="L583">583</td>
<td class="hits"></td>
<td class="source"><code>execute_transaction(Conn, Fun, Args, Retries) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L584">584</td>
<td class="hits">30</td>
<td class="source"><code>    try apply(Fun, Args) of</code></td>
</tr>
<tr>
<td class="line" id="L585">585</td>
<td class="hits"></td>
<td class="source"><code>        ResultOfFun -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L586">586</td>
<td class="hits">16</td>
<td class="source"><code>            ok = gen_server:call(Conn, commit, infinity),</code></td>
</tr>
<tr class="hit">
<td class="line" id="L587">587</td>
<td class="hits">16</td>
<td class="source"><code>            {atomic, ResultOfFun}</code></td>
</tr>
<tr>
<td class="line" id="L588">588</td>
<td class="hits"></td>
<td class="source"><code>    catch</code></td>
</tr>
<tr>
<td class="line" id="L589">589</td>
<td class="hits"></td>
<td class="source"><code>        %% We are at the top level, try to restart the transaction if there are</code></td>
</tr>
<tr>
<td class="line" id="L590">590</td>
<td class="hits"></td>
<td class="source"><code>        %% retries left</code></td>
</tr>
<tr>
<td class="line" id="L591">591</td>
<td class="hits"></td>
<td class="source"><code>        ?EXCEPTION(throw, {implicit_rollback, 1, _}, _Stacktrace)</code></td>
</tr>
<tr>
<td class="line" id="L592">592</td>
<td class="hits"></td>
<td class="source"><code>          when Retries == infinity -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L593">593</td>
<td class="hits">1</td>
<td class="source"><code>            execute_transaction(Conn, Fun, Args, infinity);</code></td>
</tr>
<tr>
<td class="line" id="L594">594</td>
<td class="hits"></td>
<td class="source"><code>        ?EXCEPTION(throw, {implicit_rollback, 1, _}, _Stacktrace)</code></td>
</tr>
<tr>
<td class="line" id="L595">595</td>
<td class="hits"></td>
<td class="source"><code>          when Retries &gt; 0 -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L596">596</td>
<td class="hits">1</td>
<td class="source"><code>            execute_transaction(Conn, Fun, Args, Retries - 1);</code></td>
</tr>
<tr>
<td class="line" id="L597">597</td>
<td class="hits"></td>
<td class="source"><code>        ?EXCEPTION(throw, {implicit_rollback, 1, Reason}, Stacktrace)</code></td>
</tr>
<tr>
<td class="line" id="L598">598</td>
<td class="hits"></td>
<td class="source"><code>          when Retries == 0 -&gt;</code></td>
</tr>
<tr>
<td class="line" id="L599">599</td>
<td class="hits"></td>
<td class="source"><code>            %% No more retries. Return 'aborted' along with the deadlock error</code></td>
</tr>
<tr>
<td class="line" id="L600">600</td>
<td class="hits"></td>
<td class="source"><code>            %% and a the trace to the line where the deadlock occured.</code></td>
</tr>
<tr class="hit">
<td class="line" id="L601">601</td>
<td class="hits">1</td>
<td class="source"><code>            Trace = ?GET_STACK(Stacktrace),</code></td>
</tr>
<tr class="hit">
<td class="line" id="L602">602</td>
<td class="hits">1</td>
<td class="source"><code>            ok = gen_server:call(Conn, rollback, infinity),</code></td>
</tr>
<tr class="hit">
<td class="line" id="L603">603</td>
<td class="hits">1</td>
<td class="source"><code>            {aborted, {Reason, Trace}};</code></td>
</tr>
<tr>
<td class="line" id="L604">604</td>
<td class="hits"></td>
<td class="source"><code>        ?EXCEPTION(throw, {implicit_rollback, N, Reason}, Stacktrace)</code></td>
</tr>
<tr>
<td class="line" id="L605">605</td>
<td class="hits"></td>
<td class="source"><code>          when N &gt; 1 -&gt;</code></td>
</tr>
<tr>
<td class="line" id="L606">606</td>
<td class="hits"></td>
<td class="source"><code>            %% Nested transaction. Bubble out to the outermost level.</code></td>
</tr>
<tr class="hit">
<td class="line" id="L607">607</td>
<td class="hits">3</td>
<td class="source"><code>            erlang:raise(throw, {implicit_rollback, N - 1, Reason},</code></td>
</tr>
<tr>
<td class="line" id="L608">608</td>
<td class="hits"></td>
<td class="source"><code>                         ?GET_STACK(Stacktrace));</code></td>
</tr>
<tr>
<td class="line" id="L609">609</td>
<td class="hits"></td>
<td class="source"><code>        ?EXCEPTION(error, {implicit_commit, _Query} = E, Stacktrace) -&gt;</code></td>
</tr>
<tr>
<td class="line" id="L610">610</td>
<td class="hits"></td>
<td class="source"><code>            %% The called did something like ALTER TABLE which resulted in an</code></td>
</tr>
<tr>
<td class="line" id="L611">611</td>
<td class="hits"></td>
<td class="source"><code>            %% implicit commit. The server has already committed. We need to</code></td>
</tr>
<tr>
<td class="line" id="L612">612</td>
<td class="hits"></td>
<td class="source"><code>            %% jump out of N levels of transactions.</code></td>
</tr>
<tr>
<td class="line" id="L613">613</td>
<td class="hits"></td>
<td class="source"><code>            %%</code></td>
</tr>
<tr>
<td class="line" id="L614">614</td>
<td class="hits"></td>
<td class="source"><code>            %% Returning 'atomic' or 'aborted' would both be wrong. Raise an</code></td>
</tr>
<tr>
<td class="line" id="L615">615</td>
<td class="hits"></td>
<td class="source"><code>            %% exception is the best we can do.</code></td>
</tr>
<tr class="hit">
<td class="line" id="L616">616</td>
<td class="hits">2</td>
<td class="source"><code>            erlang:raise(error, E, ?GET_STACK(Stacktrace));</code></td>
</tr>
<tr>
<td class="line" id="L617">617</td>
<td class="hits"></td>
<td class="source"><code>        ?EXCEPTION(error, change_user_in_transaction = E, Stacktrace) -&gt;</code></td>
</tr>
<tr>
<td class="line" id="L618">618</td>
<td class="hits"></td>
<td class="source"><code>            %% The called tried to change user inside the transaction, which</code></td>
</tr>
<tr>
<td class="line" id="L619">619</td>
<td class="hits"></td>
<td class="source"><code>            %% is not allowed and a serious mistake. We roll back and raise</code></td>
</tr>
<tr>
<td class="line" id="L620">620</td>
<td class="hits"></td>
<td class="source"><code>            %% an error.</code></td>
</tr>
<tr class="hit">
<td class="line" id="L621">621</td>
<td class="hits">1</td>
<td class="source"><code>            ok = gen_server:call(Conn, rollback, infinity),</code></td>
</tr>
<tr class="hit">
<td class="line" id="L622">622</td>
<td class="hits">1</td>
<td class="source"><code>            erlang:raise(error, E, ?GET_STACK(Stacktrace));</code></td>
</tr>
<tr>
<td class="line" id="L623">623</td>
<td class="hits"></td>
<td class="source"><code>        ?EXCEPTION(error, reset_connection_in_transaction = E, Stacktrace) -&gt;</code></td>
</tr>
<tr>
<td class="line" id="L624">624</td>
<td class="hits"></td>
<td class="source"><code>            %% The called tried to reset connection inside the transaction, which</code></td>
</tr>
<tr>
<td class="line" id="L625">625</td>
<td class="hits"></td>
<td class="source"><code>            %% is not allowed and a serious mistake. We roll back and raise</code></td>
</tr>
<tr>
<td class="line" id="L626">626</td>
<td class="hits"></td>
<td class="source"><code>            %% an error.</code></td>
</tr>
<tr class="miss">
<td class="line" id="L627">627</td>
<td class="hits">0</td>
<td class="source"><code>            ok = gen_server:call(Conn, rollback, infinity),</code></td>
</tr>
<tr class="miss">
<td class="line" id="L628">628</td>
<td class="hits">0</td>
<td class="source"><code>            erlang:raise(error, E, ?GET_STACK(Stacktrace));</code></td>
</tr>
<tr>
<td class="line" id="L629">629</td>
<td class="hits"></td>
<td class="source"><code>        ?EXCEPTION(Class, Reason, Stacktrace) -&gt;</code></td>
</tr>
<tr>
<td class="line" id="L630">630</td>
<td class="hits"></td>
<td class="source"><code>            %% We must be able to rollback. Otherwise let's crash.</code></td>
</tr>
<tr class="hit">
<td class="line" id="L631">631</td>
<td class="hits">4</td>
<td class="source"><code>            ok = gen_server:call(Conn, rollback, infinity),</code></td>
</tr>
<tr>
<td class="line" id="L632">632</td>
<td class="hits"></td>
<td class="source"><code>            %% These forms for throw, error and exit mirror Mnesia's behaviour.</code></td>
</tr>
<tr class="hit">
<td class="line" id="L633">633</td>
<td class="hits">4</td>
<td class="source"><code>            Aborted = case Class of</code></td>
</tr>
<tr class="hit">
<td class="line" id="L634">634</td>
<td class="hits">2</td>
<td class="source"><code>                throw -&gt; {throw, Reason};</code></td>
</tr>
<tr class="hit">
<td class="line" id="L635">635</td>
<td class="hits">1</td>
<td class="source"><code>                error -&gt; {Reason, ?GET_STACK(Stacktrace)};</code></td>
</tr>
<tr class="hit">
<td class="line" id="L636">636</td>
<td class="hits">1</td>
<td class="source"><code>                exit  -&gt; Reason</code></td>
</tr>
<tr>
<td class="line" id="L637">637</td>
<td class="hits"></td>
<td class="source"><code>            end,</code></td>
</tr>
<tr class="hit">
<td class="line" id="L638">638</td>
<td class="hits">4</td>
<td class="source"><code>            {aborted, Aborted}</code></td>
</tr>
<tr>
<td class="line" id="L639">639</td>
<td class="hits"></td>
<td class="source"><code>    end.</code></td>
</tr>
<tr>
<td class="line" id="L640">640</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L641">641</td>
<td class="hits"></td>
<td class="source"><code>%% @doc Equivalent to `change_user(Conn, Username, Password, [])'.</code></td>
</tr>
<tr>
<td class="line" id="L642">642</td>
<td class="hits"></td>
<td class="source"><code>%% @see change_user/4</code></td>
</tr>
<tr>
<td class="line" id="L643">643</td>
<td class="hits"></td>
<td class="source"><code>-spec change_user(Conn, Username, Password) -&gt; Result</code></td>
</tr>
<tr>
<td class="line" id="L644">644</td>
<td class="hits"></td>
<td class="source"><code>    when Conn :: connection(),</code></td>
</tr>
<tr>
<td class="line" id="L645">645</td>
<td class="hits"></td>
<td class="source"><code>         Username :: iodata(),</code></td>
</tr>
<tr>
<td class="line" id="L646">646</td>
<td class="hits"></td>
<td class="source"><code>         Password :: iodata(),</code></td>
</tr>
<tr>
<td class="line" id="L647">647</td>
<td class="hits"></td>
<td class="source"><code>         Result :: ok.</code></td>
</tr>
<tr>
<td class="line" id="L648">648</td>
<td class="hits"></td>
<td class="source"><code>change_user(Conn, Username, Password) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L649">649</td>
<td class="hits">6</td>
<td class="source"><code>    change_user(Conn, Username, Password, []).</code></td>
</tr>
<tr>
<td class="line" id="L650">650</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L651">651</td>
<td class="hits"></td>
<td class="source"><code>%% @doc Changes the user of the active connection without closing and</code></td>
</tr>
<tr>
<td class="line" id="L652">652</td>
<td class="hits"></td>
<td class="source"><code>%% and re-opening it. The currently active session will be reset (ie,</code></td>
</tr>
<tr>
<td class="line" id="L653">653</td>
<td class="hits"></td>
<td class="source"><code>%% user variables, temporary tables, prepared statements, etc will</code></td>
</tr>
<tr>
<td class="line" id="L654">654</td>
<td class="hits"></td>
<td class="source"><code>%% be lost) independent of whether the operation succeeds or fails.</code></td>
</tr>
<tr>
<td class="line" id="L655">655</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L656">656</td>
<td class="hits"></td>
<td class="source"><code>%% If change user is called when a transaction is active (ie, neither</code></td>
</tr>
<tr>
<td class="line" id="L657">657</td>
<td class="hits"></td>
<td class="source"><code>%% committed nor rolled back), calling `change_user' will fail with</code></td>
</tr>
<tr>
<td class="line" id="L658">658</td>
<td class="hits"></td>
<td class="source"><code>%% an error exception and `change_user_in_transaction' as the error</code></td>
</tr>
<tr>
<td class="line" id="L659">659</td>
<td class="hits"></td>
<td class="source"><code>%% message.</code></td>
</tr>
<tr>
<td class="line" id="L660">660</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L661">661</td>
<td class="hits"></td>
<td class="source"><code>%% If the change user operation fails, `{error, Reason}'  will be</code></td>
</tr>
<tr>
<td class="line" id="L662">662</td>
<td class="hits"></td>
<td class="source"><code>%% returned. Specifically, if the operation itself fails (eg</code></td>
</tr>
<tr>
<td class="line" id="L663">663</td>
<td class="hits"></td>
<td class="source"><code>%% authentication failure), `change_user_failed' will be returned as</code></td>
</tr>
<tr>
<td class="line" id="L664">664</td>
<td class="hits"></td>
<td class="source"><code>%% the reason, while if the operation itself succeeds but one of</code></td>
</tr>
<tr>
<td class="line" id="L665">665</td>
<td class="hits"></td>
<td class="source"><code>%% the given initial queries or prepares fails, the reason will</code></td>
</tr>
<tr>
<td class="line" id="L666">666</td>
<td class="hits"></td>
<td class="source"><code>%% reflect the cause for the failure. In any case, the connection</code></td>
</tr>
<tr>
<td class="line" id="L667">667</td>
<td class="hits"></td>
<td class="source"><code>%% process will exit with the same reason and cannot be used any longer.</code></td>
</tr>
<tr>
<td class="line" id="L668">668</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L669">669</td>
<td class="hits"></td>
<td class="source"><code>%% For a description of the `database', `queries' and `prepare'</code></td>
</tr>
<tr>
<td class="line" id="L670">670</td>
<td class="hits"></td>
<td class="source"><code>%% options, see `start_link/1'.</code></td>
</tr>
<tr>
<td class="line" id="L671">671</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L672">672</td>
<td class="hits"></td>
<td class="source"><code>%% @see start_link/1</code></td>
</tr>
<tr>
<td class="line" id="L673">673</td>
<td class="hits"></td>
<td class="source"><code>-spec change_user(Conn, Username, Password, Options) -&gt; Result</code></td>
</tr>
<tr>
<td class="line" id="L674">674</td>
<td class="hits"></td>
<td class="source"><code>    when Conn :: connection(),</code></td>
</tr>
<tr>
<td class="line" id="L675">675</td>
<td class="hits"></td>
<td class="source"><code>         Username :: iodata(),</code></td>
</tr>
<tr>
<td class="line" id="L676">676</td>
<td class="hits"></td>
<td class="source"><code>         Password :: iodata(),</code></td>
</tr>
<tr>
<td class="line" id="L677">677</td>
<td class="hits"></td>
<td class="source"><code>         Options :: [Option],</code></td>
</tr>
<tr>
<td class="line" id="L678">678</td>
<td class="hits"></td>
<td class="source"><code>         Result :: ok,</code></td>
</tr>
<tr>
<td class="line" id="L679">679</td>
<td class="hits"></td>
<td class="source"><code>         Option :: {database, iodata()}</code></td>
</tr>
<tr>
<td class="line" id="L680">680</td>
<td class="hits"></td>
<td class="source"><code>                 | {queries, [iodata()]}</code></td>
</tr>
<tr>
<td class="line" id="L681">681</td>
<td class="hits"></td>
<td class="source"><code>                 | {prepare, [NamedStatement]},</code></td>
</tr>
<tr>
<td class="line" id="L682">682</td>
<td class="hits"></td>
<td class="source"><code>         NamedStatement :: {StatementName :: atom(), Statement :: iodata()}.</code></td>
</tr>
<tr>
<td class="line" id="L683">683</td>
<td class="hits"></td>
<td class="source"><code>change_user(Conn, Username, Password, Options) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L684">684</td>
<td class="hits">11</td>
<td class="source"><code>    case in_transaction(Conn) of</code></td>
</tr>
<tr class="hit">
<td class="line" id="L685">685</td>
<td class="hits">2</td>
<td class="source"><code>        true -&gt; error(change_user_in_transaction);</code></td>
</tr>
<tr class="hit">
<td class="line" id="L686">686</td>
<td class="hits">9</td>
<td class="source"><code>        false -&gt; ok</code></td>
</tr>
<tr>
<td class="line" id="L687">687</td>
<td class="hits"></td>
<td class="source"><code>    end,</code></td>
</tr>
<tr class="hit">
<td class="line" id="L688">688</td>
<td class="hits">9</td>
<td class="source"><code>    gen_server:call(Conn, {change_user, Username, Password, Options}).</code></td>
</tr>
<tr>
<td class="line" id="L689">689</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L690">690</td>
<td class="hits"></td>
<td class="source"><code>-spec reset_connection(Conn) -&gt; ok | {error, Reason}</code></td>
</tr>
<tr>
<td class="line" id="L691">691</td>
<td class="hits"></td>
<td class="source"><code>    when Conn :: connection(),</code></td>
</tr>
<tr>
<td class="line" id="L692">692</td>
<td class="hits"></td>
<td class="source"><code>         Reason :: server_reason().</code></td>
</tr>
<tr>
<td class="line" id="L693">693</td>
<td class="hits"></td>
<td class="source"><code>reset_connection(Conn) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L694">694</td>
<td class="hits">1</td>
<td class="source"><code>    case in_transaction(Conn) of</code></td>
</tr>
<tr class="miss">
<td class="line" id="L695">695</td>
<td class="hits">0</td>
<td class="source"><code>        true -&gt; error(reset_connection_in_transaction);</code></td>
</tr>
<tr class="hit">
<td class="line" id="L696">696</td>
<td class="hits">1</td>
<td class="source"><code>        false -&gt; ok</code></td>
</tr>
<tr>
<td class="line" id="L697">697</td>
<td class="hits"></td>
<td class="source"><code>    end,</code></td>
</tr>
<tr class="hit">
<td class="line" id="L698">698</td>
<td class="hits">1</td>
<td class="source"><code>    gen_server:call(Conn, reset_connection).</code></td>
</tr>
<tr>
<td class="line" id="L699">699</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L700">700</td>
<td class="hits"></td>
<td class="source"><code>%% @doc Encodes a term as a MySQL literal so that it can be used to inside a</code></td>
</tr>
<tr>
<td class="line" id="L701">701</td>
<td class="hits"></td>
<td class="source"><code>%% query. If backslash escapes are enabled, backslashes and single quotes in</code></td>
</tr>
<tr>
<td class="line" id="L702">702</td>
<td class="hits"></td>
<td class="source"><code>%% strings and binaries are escaped. Otherwise only single quotes are escaped.</code></td>
</tr>
<tr>
<td class="line" id="L703">703</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L704">704</td>
<td class="hits"></td>
<td class="source"><code>%% Note that the preferred way of sending values is by prepared statements or</code></td>
</tr>
<tr>
<td class="line" id="L705">705</td>
<td class="hits"></td>
<td class="source"><code>%% parametrized queries with placeholders.</code></td>
</tr>
<tr>
<td class="line" id="L706">706</td>
<td class="hits"></td>
<td class="source"><code>%%</code></td>
</tr>
<tr>
<td class="line" id="L707">707</td>
<td class="hits"></td>
<td class="source"><code>%% @see query/3</code></td>
</tr>
<tr>
<td class="line" id="L708">708</td>
<td class="hits"></td>
<td class="source"><code>%% @see execute/3</code></td>
</tr>
<tr>
<td class="line" id="L709">709</td>
<td class="hits"></td>
<td class="source"><code>-spec encode(connection(), term()) -&gt; iodata().</code></td>
</tr>
<tr>
<td class="line" id="L710">710</td>
<td class="hits"></td>
<td class="source"><code>encode(Conn, Term) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L711">711</td>
<td class="hits">2</td>
<td class="source"><code>    Term1 = case (is_list(Term) orelse is_binary(Term)) andalso</code></td>
</tr>
<tr class="hit">
<td class="line" id="L712">712</td>
<td class="hits">2</td>
<td class="source"><code>                 gen_server:call(Conn, backslash_escapes_enabled) of</code></td>
</tr>
<tr class="hit">
<td class="line" id="L713">713</td>
<td class="hits">1</td>
<td class="source"><code>        true  -&gt; mysql_encode:backslash_escape(Term);</code></td>
</tr>
<tr class="hit">
<td class="line" id="L714">714</td>
<td class="hits">1</td>
<td class="source"><code>        false -&gt; Term</code></td>
</tr>
<tr>
<td class="line" id="L715">715</td>
<td class="hits"></td>
<td class="source"><code>    end,</code></td>
</tr>
<tr class="hit">
<td class="line" id="L716">716</td>
<td class="hits">2</td>
<td class="source"><code>    mysql_encode:encode(Term1).</code></td>
</tr>
<tr>
<td class="line" id="L717">717</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L718">718</td>
<td class="hits"></td>
<td class="source"><code>%% --- Helpers ---</code></td>
</tr>
<tr>
<td class="line" id="L719">719</td>
<td class="hits"></td>
<td class="source"><code></code></td>
</tr>
<tr>
<td class="line" id="L720">720</td>
<td class="hits"></td>
<td class="source"><code>%% @doc Makes a gen_server call for a query (plain, parametrized or prepared),</code></td>
</tr>
<tr>
<td class="line" id="L721">721</td>
<td class="hits"></td>
<td class="source"><code>%% checks the reply and sometimes throws an exception when we need to jump out</code></td>
</tr>
<tr>
<td class="line" id="L722">722</td>
<td class="hits"></td>
<td class="source"><code>%% of a transaction.</code></td>
</tr>
<tr>
<td class="line" id="L723">723</td>
<td class="hits"></td>
<td class="source"><code>query_call(Conn, CallReq) -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L724">724</td>
<td class="hits">624</td>
<td class="source"><code>    case gen_server:call(Conn, CallReq, infinity) of</code></td>
</tr>
<tr>
<td class="line" id="L725">725</td>
<td class="hits"></td>
<td class="source"><code>        {implicit_commit, _NestingLevel, Query} -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L726">726</td>
<td class="hits">1</td>
<td class="source"><code>            error({implicit_commit, Query});</code></td>
</tr>
<tr>
<td class="line" id="L727">727</td>
<td class="hits"></td>
<td class="source"><code>        {implicit_rollback, _NestingLevel, _ServerReason} = ImplicitRollback -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L728">728</td>
<td class="hits">3</td>
<td class="source"><code>            throw(ImplicitRollback);</code></td>
</tr>
<tr>
<td class="line" id="L729">729</td>
<td class="hits"></td>
<td class="source"><code>        Result -&gt;</code></td>
</tr>
<tr class="hit">
<td class="line" id="L730">730</td>
<td class="hits">620</td>
<td class="source"><code>            Result</code></td>
</tr>
<tr>
<td class="line" id="L731">731</td>
<td class="hits"></td>
<td class="source"><code>    end.</code></td>
</tr>
</tbody>
<thead>
<tr>
<th>Line</th>
<th>Hits</th>
<th>Source</th>
</tr>
</thead>
</table>
</body>
</html>
